<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript图解作用域链与闭包 | ZB-Notes</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/logo.png">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.5e6abf62.css" as="style"><link rel="preload" href="/assets/js/app.9183dc48.js" as="script"><link rel="preload" href="/assets/js/127.b6e7f39a.js" as="script"><link rel="preload" href="/assets/js/3.e72fa89a.js" as="script"><link rel="preload" href="/assets/js/13.4bad6da3.js" as="script"><link rel="prefetch" href="/assets/js/10.f535fde6.js"><link rel="prefetch" href="/assets/js/100.e585abcd.js"><link rel="prefetch" href="/assets/js/101.6d6cd206.js"><link rel="prefetch" href="/assets/js/102.0f68514e.js"><link rel="prefetch" href="/assets/js/103.73bf1d07.js"><link rel="prefetch" href="/assets/js/104.1213fe0e.js"><link rel="prefetch" href="/assets/js/105.9ab30de4.js"><link rel="prefetch" href="/assets/js/106.1cbe6d63.js"><link rel="prefetch" href="/assets/js/107.2483e919.js"><link rel="prefetch" href="/assets/js/108.2766d961.js"><link rel="prefetch" href="/assets/js/109.1f3955c2.js"><link rel="prefetch" href="/assets/js/11.83d0f9f6.js"><link rel="prefetch" href="/assets/js/110.65a66cdd.js"><link rel="prefetch" href="/assets/js/111.3a238953.js"><link rel="prefetch" href="/assets/js/112.878d17ae.js"><link rel="prefetch" href="/assets/js/113.191fbad8.js"><link rel="prefetch" href="/assets/js/114.fe1ac853.js"><link rel="prefetch" href="/assets/js/115.04dea7fa.js"><link rel="prefetch" href="/assets/js/116.c71ae24e.js"><link rel="prefetch" href="/assets/js/117.5272491f.js"><link rel="prefetch" href="/assets/js/118.e9c0c460.js"><link rel="prefetch" href="/assets/js/119.f13a2931.js"><link rel="prefetch" href="/assets/js/12.b1804325.js"><link rel="prefetch" href="/assets/js/120.75161273.js"><link rel="prefetch" href="/assets/js/121.bfa4e3fa.js"><link rel="prefetch" href="/assets/js/122.c9818133.js"><link rel="prefetch" href="/assets/js/123.e6ae57c8.js"><link rel="prefetch" href="/assets/js/124.c6018a46.js"><link rel="prefetch" href="/assets/js/125.94c7e660.js"><link rel="prefetch" href="/assets/js/126.e366f522.js"><link rel="prefetch" href="/assets/js/128.1904509d.js"><link rel="prefetch" href="/assets/js/129.13ee7539.js"><link rel="prefetch" href="/assets/js/130.93d5face.js"><link rel="prefetch" href="/assets/js/131.0b84a187.js"><link rel="prefetch" href="/assets/js/132.72ddaf00.js"><link rel="prefetch" href="/assets/js/133.25bbd8dd.js"><link rel="prefetch" href="/assets/js/134.620c7d90.js"><link rel="prefetch" href="/assets/js/135.43d15dff.js"><link rel="prefetch" href="/assets/js/136.e4d04b15.js"><link rel="prefetch" href="/assets/js/137.be580e6e.js"><link rel="prefetch" href="/assets/js/138.1d78c10f.js"><link rel="prefetch" href="/assets/js/139.f4a39cf9.js"><link rel="prefetch" href="/assets/js/14.be8db819.js"><link rel="prefetch" href="/assets/js/140.566d1afc.js"><link rel="prefetch" href="/assets/js/141.07f40500.js"><link rel="prefetch" href="/assets/js/142.3dde80c6.js"><link rel="prefetch" href="/assets/js/143.118e79a3.js"><link rel="prefetch" href="/assets/js/144.795265a0.js"><link rel="prefetch" href="/assets/js/145.32b11f27.js"><link rel="prefetch" href="/assets/js/146.5ce35f0e.js"><link rel="prefetch" href="/assets/js/147.abbead64.js"><link rel="prefetch" href="/assets/js/148.b0e65634.js"><link rel="prefetch" href="/assets/js/149.167aefc5.js"><link rel="prefetch" href="/assets/js/15.3f0a639b.js"><link rel="prefetch" href="/assets/js/150.1a9f807a.js"><link rel="prefetch" href="/assets/js/151.c352c805.js"><link rel="prefetch" href="/assets/js/152.b1460d3d.js"><link rel="prefetch" href="/assets/js/153.4cfc2dd9.js"><link rel="prefetch" href="/assets/js/154.fa4dfd51.js"><link rel="prefetch" href="/assets/js/155.1c5defc6.js"><link rel="prefetch" href="/assets/js/156.b612970e.js"><link rel="prefetch" href="/assets/js/157.4e9a7d54.js"><link rel="prefetch" href="/assets/js/158.5d70bcc9.js"><link rel="prefetch" href="/assets/js/159.c7aa3a8b.js"><link rel="prefetch" href="/assets/js/16.430cd672.js"><link rel="prefetch" href="/assets/js/160.1a603b72.js"><link rel="prefetch" href="/assets/js/161.47beeba8.js"><link rel="prefetch" href="/assets/js/162.2f8a82b4.js"><link rel="prefetch" href="/assets/js/163.50ea2122.js"><link rel="prefetch" href="/assets/js/164.318f0648.js"><link rel="prefetch" href="/assets/js/165.5285f26c.js"><link rel="prefetch" href="/assets/js/166.83f5037d.js"><link rel="prefetch" href="/assets/js/167.855c525e.js"><link rel="prefetch" href="/assets/js/168.77e0f1d6.js"><link rel="prefetch" href="/assets/js/169.90de0f79.js"><link rel="prefetch" href="/assets/js/17.743c2cbb.js"><link rel="prefetch" href="/assets/js/170.955ad965.js"><link rel="prefetch" href="/assets/js/171.fbef02a5.js"><link rel="prefetch" href="/assets/js/172.27ecc0c2.js"><link rel="prefetch" href="/assets/js/173.85f0edad.js"><link rel="prefetch" href="/assets/js/174.2c3c0b30.js"><link rel="prefetch" href="/assets/js/175.4ba8cf06.js"><link rel="prefetch" href="/assets/js/176.8a7531f1.js"><link rel="prefetch" href="/assets/js/177.acf2ad52.js"><link rel="prefetch" href="/assets/js/178.81cdfa8d.js"><link rel="prefetch" href="/assets/js/179.bf472f77.js"><link rel="prefetch" href="/assets/js/18.95b2960e.js"><link rel="prefetch" href="/assets/js/180.fae6a0c8.js"><link rel="prefetch" href="/assets/js/181.f8e6ca70.js"><link rel="prefetch" href="/assets/js/182.7f9c3a9b.js"><link rel="prefetch" href="/assets/js/183.a8415dbe.js"><link rel="prefetch" href="/assets/js/184.233dbc14.js"><link rel="prefetch" href="/assets/js/185.4e879e98.js"><link rel="prefetch" href="/assets/js/186.e507c02f.js"><link rel="prefetch" href="/assets/js/187.6f0c4fa0.js"><link rel="prefetch" href="/assets/js/188.ca1a265c.js"><link rel="prefetch" href="/assets/js/189.6f8465e6.js"><link rel="prefetch" href="/assets/js/19.22ca969f.js"><link rel="prefetch" href="/assets/js/190.d0b57012.js"><link rel="prefetch" href="/assets/js/191.586fe3a2.js"><link rel="prefetch" href="/assets/js/192.2071d885.js"><link rel="prefetch" href="/assets/js/193.cfca6bdf.js"><link rel="prefetch" href="/assets/js/194.dd719e16.js"><link rel="prefetch" href="/assets/js/195.e8a42785.js"><link rel="prefetch" href="/assets/js/196.b7b21fd3.js"><link rel="prefetch" href="/assets/js/197.7c47d798.js"><link rel="prefetch" href="/assets/js/198.1de68f2f.js"><link rel="prefetch" href="/assets/js/199.7970a3cb.js"><link rel="prefetch" href="/assets/js/2.a1801f46.js"><link rel="prefetch" href="/assets/js/20.3a587807.js"><link rel="prefetch" href="/assets/js/200.b5388931.js"><link rel="prefetch" href="/assets/js/201.5fa67630.js"><link rel="prefetch" href="/assets/js/202.5c5efa95.js"><link rel="prefetch" href="/assets/js/203.29cdcf27.js"><link rel="prefetch" href="/assets/js/204.7d7de884.js"><link rel="prefetch" href="/assets/js/205.5ccd9f5f.js"><link rel="prefetch" href="/assets/js/206.7407d960.js"><link rel="prefetch" href="/assets/js/207.c0ae912e.js"><link rel="prefetch" href="/assets/js/208.689708f2.js"><link rel="prefetch" href="/assets/js/209.13cd9f38.js"><link rel="prefetch" href="/assets/js/21.88790cdd.js"><link rel="prefetch" href="/assets/js/210.0cc4ecd9.js"><link rel="prefetch" href="/assets/js/211.c9e2c59e.js"><link rel="prefetch" href="/assets/js/212.debf74f9.js"><link rel="prefetch" href="/assets/js/213.cc3953fc.js"><link rel="prefetch" href="/assets/js/214.43b2fe42.js"><link rel="prefetch" href="/assets/js/215.22f95420.js"><link rel="prefetch" href="/assets/js/216.2ced123c.js"><link rel="prefetch" href="/assets/js/217.82ad5303.js"><link rel="prefetch" href="/assets/js/218.ed9c052c.js"><link rel="prefetch" href="/assets/js/219.c957bee2.js"><link rel="prefetch" href="/assets/js/22.b9407d63.js"><link rel="prefetch" href="/assets/js/220.08e415f9.js"><link rel="prefetch" href="/assets/js/221.af35a579.js"><link rel="prefetch" href="/assets/js/222.76eef6f2.js"><link rel="prefetch" href="/assets/js/223.f6997158.js"><link rel="prefetch" href="/assets/js/224.0177e6bf.js"><link rel="prefetch" href="/assets/js/225.6c1809be.js"><link rel="prefetch" href="/assets/js/226.7f325c5e.js"><link rel="prefetch" href="/assets/js/227.3934aeaa.js"><link rel="prefetch" href="/assets/js/228.14147f23.js"><link rel="prefetch" href="/assets/js/229.949e1c15.js"><link rel="prefetch" href="/assets/js/23.1d784e73.js"><link rel="prefetch" href="/assets/js/230.3eaa7849.js"><link rel="prefetch" href="/assets/js/231.71a12a2b.js"><link rel="prefetch" href="/assets/js/232.04245fd7.js"><link rel="prefetch" href="/assets/js/233.cb93897a.js"><link rel="prefetch" href="/assets/js/234.0e51f40d.js"><link rel="prefetch" href="/assets/js/235.3cdf817c.js"><link rel="prefetch" href="/assets/js/236.a05a80c2.js"><link rel="prefetch" href="/assets/js/237.6c626852.js"><link rel="prefetch" href="/assets/js/238.1fb1e7af.js"><link rel="prefetch" href="/assets/js/239.25580979.js"><link rel="prefetch" href="/assets/js/24.4d1bcce6.js"><link rel="prefetch" href="/assets/js/240.ffccca7f.js"><link rel="prefetch" href="/assets/js/241.23ca8802.js"><link rel="prefetch" href="/assets/js/242.71fadb4d.js"><link rel="prefetch" href="/assets/js/243.ff1e3883.js"><link rel="prefetch" href="/assets/js/244.ded9c1e0.js"><link rel="prefetch" href="/assets/js/245.747075b9.js"><link rel="prefetch" href="/assets/js/246.68ec5c76.js"><link rel="prefetch" href="/assets/js/247.1e29c1ca.js"><link rel="prefetch" href="/assets/js/248.9eb4b80c.js"><link rel="prefetch" href="/assets/js/249.2edc7b76.js"><link rel="prefetch" href="/assets/js/25.890f46ae.js"><link rel="prefetch" href="/assets/js/250.af69f0bc.js"><link rel="prefetch" href="/assets/js/251.0d1e8c08.js"><link rel="prefetch" href="/assets/js/252.e15d765f.js"><link rel="prefetch" href="/assets/js/253.bab38f4c.js"><link rel="prefetch" href="/assets/js/254.b177cab1.js"><link rel="prefetch" href="/assets/js/255.e634566d.js"><link rel="prefetch" href="/assets/js/256.5e102d9a.js"><link rel="prefetch" href="/assets/js/257.0563503d.js"><link rel="prefetch" href="/assets/js/258.3904d8b4.js"><link rel="prefetch" href="/assets/js/259.cfa2fd70.js"><link rel="prefetch" href="/assets/js/26.d90819c7.js"><link rel="prefetch" href="/assets/js/260.ba21761f.js"><link rel="prefetch" href="/assets/js/261.54cdb61b.js"><link rel="prefetch" href="/assets/js/262.92f444b6.js"><link rel="prefetch" href="/assets/js/263.573d714e.js"><link rel="prefetch" href="/assets/js/264.3f022b6f.js"><link rel="prefetch" href="/assets/js/265.77f16fb3.js"><link rel="prefetch" href="/assets/js/266.3831dc5c.js"><link rel="prefetch" href="/assets/js/267.0725e50d.js"><link rel="prefetch" href="/assets/js/268.838f91ac.js"><link rel="prefetch" href="/assets/js/269.b4abdb5b.js"><link rel="prefetch" href="/assets/js/27.ea129088.js"><link rel="prefetch" href="/assets/js/270.9c3fabe7.js"><link rel="prefetch" href="/assets/js/271.fed379bf.js"><link rel="prefetch" href="/assets/js/272.72f8b02f.js"><link rel="prefetch" href="/assets/js/273.39cfb9c8.js"><link rel="prefetch" href="/assets/js/274.1590ebff.js"><link rel="prefetch" href="/assets/js/275.f9d8055f.js"><link rel="prefetch" href="/assets/js/276.f07513c5.js"><link rel="prefetch" href="/assets/js/277.c62e2eea.js"><link rel="prefetch" href="/assets/js/278.64fca9d3.js"><link rel="prefetch" href="/assets/js/279.172b18bc.js"><link rel="prefetch" href="/assets/js/28.cbeb58aa.js"><link rel="prefetch" href="/assets/js/280.ac4a96fc.js"><link rel="prefetch" href="/assets/js/281.c31ad5da.js"><link rel="prefetch" href="/assets/js/282.8fa7ef0b.js"><link rel="prefetch" href="/assets/js/283.81f8c403.js"><link rel="prefetch" href="/assets/js/284.edf45079.js"><link rel="prefetch" href="/assets/js/285.75c3bc82.js"><link rel="prefetch" href="/assets/js/286.c17b0350.js"><link rel="prefetch" href="/assets/js/287.447122aa.js"><link rel="prefetch" href="/assets/js/288.ed6f0804.js"><link rel="prefetch" href="/assets/js/289.e614c4c2.js"><link rel="prefetch" href="/assets/js/29.e3f5a936.js"><link rel="prefetch" href="/assets/js/290.94677db6.js"><link rel="prefetch" href="/assets/js/291.aa295671.js"><link rel="prefetch" href="/assets/js/292.ff765b29.js"><link rel="prefetch" href="/assets/js/293.70c698af.js"><link rel="prefetch" href="/assets/js/294.065a8d5f.js"><link rel="prefetch" href="/assets/js/295.b2ba8b22.js"><link rel="prefetch" href="/assets/js/296.98e9da73.js"><link rel="prefetch" href="/assets/js/297.d40414ae.js"><link rel="prefetch" href="/assets/js/298.f10fcd53.js"><link rel="prefetch" href="/assets/js/299.2099838a.js"><link rel="prefetch" href="/assets/js/30.6d703dcc.js"><link rel="prefetch" href="/assets/js/300.0cfc5419.js"><link rel="prefetch" href="/assets/js/301.509df13a.js"><link rel="prefetch" href="/assets/js/302.8be07830.js"><link rel="prefetch" href="/assets/js/303.a7726893.js"><link rel="prefetch" href="/assets/js/304.2e65243e.js"><link rel="prefetch" href="/assets/js/305.d0fd2016.js"><link rel="prefetch" href="/assets/js/306.9358c58b.js"><link rel="prefetch" href="/assets/js/307.00a40dbc.js"><link rel="prefetch" href="/assets/js/308.0438a7f0.js"><link rel="prefetch" href="/assets/js/309.6b3c1328.js"><link rel="prefetch" href="/assets/js/31.5211ec4a.js"><link rel="prefetch" href="/assets/js/310.41250083.js"><link rel="prefetch" href="/assets/js/311.0b0e824f.js"><link rel="prefetch" href="/assets/js/312.e8b819be.js"><link rel="prefetch" href="/assets/js/313.7c0fed90.js"><link rel="prefetch" href="/assets/js/314.37c71cbe.js"><link rel="prefetch" href="/assets/js/315.3a90afe5.js"><link rel="prefetch" href="/assets/js/316.07befc59.js"><link rel="prefetch" href="/assets/js/317.0f1b0e41.js"><link rel="prefetch" href="/assets/js/318.6162c92c.js"><link rel="prefetch" href="/assets/js/319.53ba4545.js"><link rel="prefetch" href="/assets/js/32.79740f13.js"><link rel="prefetch" href="/assets/js/320.d5d02efc.js"><link rel="prefetch" href="/assets/js/321.90202c35.js"><link rel="prefetch" href="/assets/js/322.d5c1127c.js"><link rel="prefetch" href="/assets/js/323.2fb0d163.js"><link rel="prefetch" href="/assets/js/324.594f9a05.js"><link rel="prefetch" href="/assets/js/325.64f88b7d.js"><link rel="prefetch" href="/assets/js/326.34d03ceb.js"><link rel="prefetch" href="/assets/js/327.b5409c78.js"><link rel="prefetch" href="/assets/js/328.4ee96a7c.js"><link rel="prefetch" href="/assets/js/329.00543f24.js"><link rel="prefetch" href="/assets/js/33.3213dc4d.js"><link rel="prefetch" href="/assets/js/330.91ba9a82.js"><link rel="prefetch" href="/assets/js/331.e534dcdd.js"><link rel="prefetch" href="/assets/js/332.528190d6.js"><link rel="prefetch" href="/assets/js/34.0479cfea.js"><link rel="prefetch" href="/assets/js/35.62844ca7.js"><link rel="prefetch" href="/assets/js/36.797dbe09.js"><link rel="prefetch" href="/assets/js/37.639f1289.js"><link rel="prefetch" href="/assets/js/38.0d4198c2.js"><link rel="prefetch" href="/assets/js/39.c511da8b.js"><link rel="prefetch" href="/assets/js/4.a2b19b6e.js"><link rel="prefetch" href="/assets/js/40.91d2bca7.js"><link rel="prefetch" href="/assets/js/41.acf4a677.js"><link rel="prefetch" href="/assets/js/42.8f5d5bc1.js"><link rel="prefetch" href="/assets/js/43.29b762dc.js"><link rel="prefetch" href="/assets/js/44.cd266de3.js"><link rel="prefetch" href="/assets/js/45.450c93e8.js"><link rel="prefetch" href="/assets/js/46.1d691666.js"><link rel="prefetch" href="/assets/js/47.f7d0003c.js"><link rel="prefetch" href="/assets/js/48.a2231eff.js"><link rel="prefetch" href="/assets/js/49.874f53aa.js"><link rel="prefetch" href="/assets/js/5.e15a2319.js"><link rel="prefetch" href="/assets/js/50.e57c1303.js"><link rel="prefetch" href="/assets/js/51.0fa4b883.js"><link rel="prefetch" href="/assets/js/52.ea768dd9.js"><link rel="prefetch" href="/assets/js/53.beb2c29a.js"><link rel="prefetch" href="/assets/js/54.95c3d237.js"><link rel="prefetch" href="/assets/js/55.00fd38bb.js"><link rel="prefetch" href="/assets/js/56.0650ec4c.js"><link rel="prefetch" href="/assets/js/57.cd6a07b0.js"><link rel="prefetch" href="/assets/js/58.385f2dd8.js"><link rel="prefetch" href="/assets/js/59.83522701.js"><link rel="prefetch" href="/assets/js/6.10cb9ffe.js"><link rel="prefetch" href="/assets/js/60.982f805f.js"><link rel="prefetch" href="/assets/js/61.d439affb.js"><link rel="prefetch" href="/assets/js/62.ceb8712f.js"><link rel="prefetch" href="/assets/js/63.736dbe70.js"><link rel="prefetch" href="/assets/js/64.bd7d2c0f.js"><link rel="prefetch" href="/assets/js/65.3202694b.js"><link rel="prefetch" href="/assets/js/66.ed7ca341.js"><link rel="prefetch" href="/assets/js/67.45c8b959.js"><link rel="prefetch" href="/assets/js/68.4de44aad.js"><link rel="prefetch" href="/assets/js/69.0df14048.js"><link rel="prefetch" href="/assets/js/7.538173c9.js"><link rel="prefetch" href="/assets/js/70.d178ec66.js"><link rel="prefetch" href="/assets/js/71.5f2b73dd.js"><link rel="prefetch" href="/assets/js/72.1499eade.js"><link rel="prefetch" href="/assets/js/73.39378169.js"><link rel="prefetch" href="/assets/js/74.aab9f4cd.js"><link rel="prefetch" href="/assets/js/75.58af5dcb.js"><link rel="prefetch" href="/assets/js/76.ddebe4de.js"><link rel="prefetch" href="/assets/js/77.795376b5.js"><link rel="prefetch" href="/assets/js/78.9d59b408.js"><link rel="prefetch" href="/assets/js/79.a48d3c50.js"><link rel="prefetch" href="/assets/js/8.5f0cbc1e.js"><link rel="prefetch" href="/assets/js/80.56981d9a.js"><link rel="prefetch" href="/assets/js/81.a177e7bb.js"><link rel="prefetch" href="/assets/js/82.13486971.js"><link rel="prefetch" href="/assets/js/83.89195269.js"><link rel="prefetch" href="/assets/js/84.3ef3070c.js"><link rel="prefetch" href="/assets/js/85.a0af9b6c.js"><link rel="prefetch" href="/assets/js/86.ec91bf6b.js"><link rel="prefetch" href="/assets/js/87.5d4eb344.js"><link rel="prefetch" href="/assets/js/88.e6f8ec26.js"><link rel="prefetch" href="/assets/js/89.24c96fbd.js"><link rel="prefetch" href="/assets/js/9.b8c9c0ed.js"><link rel="prefetch" href="/assets/js/90.a6a15ea3.js"><link rel="prefetch" href="/assets/js/91.3386a314.js"><link rel="prefetch" href="/assets/js/92.b2be18b1.js"><link rel="prefetch" href="/assets/js/93.9afe721c.js"><link rel="prefetch" href="/assets/js/94.6cb996fc.js"><link rel="prefetch" href="/assets/js/95.e28a0e9b.js"><link rel="prefetch" href="/assets/js/96.187bf387.js"><link rel="prefetch" href="/assets/js/97.bc059528.js"><link rel="prefetch" href="/assets/js/98.bad8f1e3.js"><link rel="prefetch" href="/assets/js/99.8812ae44.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5e6abf62.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/homepic.gif" alt="ZB-Notes" class="logo"> <span class="site-name can-hide">ZB-Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/Algorithm/LeetCode/" class="nav-link">
  Leetcode 题解
</a></li><li class="dropdown-item"><!----> <a href="/views/Algorithm/JZOffer/" class="nav-link">
  剑指 Offer 题解
</a></li><li class="dropdown-item"><!----> <a href="/views/Algorithm/PTA/PATBasicLevelPractice/" class="nav-link">
  PAT Basic Level Practice
</a></li><li class="dropdown-item"><!----> <a href="/views/Algorithm/PTA/PythonPractice/" class="nav-link">
  浙大版Python程序设计题目集
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端八股文" class="dropdown-title"><span class="title">前端八股文</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端八股文" class="mobile-dropdown-title"><span class="title">前端八股文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/JsGuide/JavaScript/" class="nav-link router-link-active">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/views/JsGuide/Interview/" class="nav-link">
  高频面经
</a></li><li class="dropdown-item"><!----> <a href="/views/JsGuide/InterviewGuide/" class="nav-link">
  其他面经
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="WebPack" class="dropdown-title"><span class="title">WebPack</span> <span class="arrow down"></span></button> <button type="button" aria-label="WebPack" class="mobile-dropdown-title"><span class="title">WebPack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/intro/" class="nav-link">
  介绍
</a></li><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/base/" class="nav-link">
  基础配置
</a></li><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/senior/" class="nav-link">
  高级优化
</a></li><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/project/" class="nav-link">
  项目配置
</a></li><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/origin/" class="nav-link">
  原理分析
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/Vue/VueNotes/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/views/Vue/VueProject/" class="nav-link">
  项目
</a></li></ul></div></div><div class="nav-item"><a href="/views/Java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/views/DesignPattern/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="https://github.com/Axehco" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/Algorithm/LeetCode/" class="nav-link">
  Leetcode 题解
</a></li><li class="dropdown-item"><!----> <a href="/views/Algorithm/JZOffer/" class="nav-link">
  剑指 Offer 题解
</a></li><li class="dropdown-item"><!----> <a href="/views/Algorithm/PTA/PATBasicLevelPractice/" class="nav-link">
  PAT Basic Level Practice
</a></li><li class="dropdown-item"><!----> <a href="/views/Algorithm/PTA/PythonPractice/" class="nav-link">
  浙大版Python程序设计题目集
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端八股文" class="dropdown-title"><span class="title">前端八股文</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端八股文" class="mobile-dropdown-title"><span class="title">前端八股文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/JsGuide/JavaScript/" class="nav-link router-link-active">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/views/JsGuide/Interview/" class="nav-link">
  高频面经
</a></li><li class="dropdown-item"><!----> <a href="/views/JsGuide/InterviewGuide/" class="nav-link">
  其他面经
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="WebPack" class="dropdown-title"><span class="title">WebPack</span> <span class="arrow down"></span></button> <button type="button" aria-label="WebPack" class="mobile-dropdown-title"><span class="title">WebPack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/intro/" class="nav-link">
  介绍
</a></li><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/base/" class="nav-link">
  基础配置
</a></li><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/senior/" class="nav-link">
  高级优化
</a></li><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/project/" class="nav-link">
  项目配置
</a></li><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/origin/" class="nav-link">
  原理分析
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/Vue/VueNotes/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/views/Vue/VueProject/" class="nav-link">
  项目
</a></li></ul></div></div><div class="nav-item"><a href="/views/Java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/views/DesignPattern/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="https://github.com/Axehco" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>基础篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/JsGuide/JavaScript/01.JavaScript世界万物诞生记.html" class="sidebar-link">JavaScript世界万物诞生记</a></li><li><a href="/views/JsGuide/JavaScript/02.JavaScript执行上下文详细图解.html" class="sidebar-link">JavaScript执行上下文详细图解</a></li><li><a href="/views/JsGuide/JavaScript/03.JavaScript执行上下文详细图解变量对象详解.html" class="sidebar-link">JavaScript变量对象详解</a></li><li><a href="/views/JsGuide/JavaScript/04.JavaScrip图解作用域链与闭包.html" class="active sidebar-link">JavaScript图解作用域链与闭包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/JsGuide/JavaScript/04.JavaScrip图解作用域链与闭包.html#_1-作用域与作用域链" class="sidebar-link">1. 作用域与作用域链</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/JsGuide/JavaScript/04.JavaScrip图解作用域链与闭包.html#_1-1-作用域" class="sidebar-link">1.1 作用域</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/JavaScript/04.JavaScrip图解作用域链与闭包.html#_1-2-作用域链" class="sidebar-link">1.2 作用域链</a></li></ul></li><li class="sidebar-sub-header"><a href="/views/JsGuide/JavaScript/04.JavaScrip图解作用域链与闭包.html#_2-闭包" class="sidebar-link">2. 闭包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/JsGuide/JavaScript/04.JavaScrip图解作用域链与闭包.html#_2-1-定义" class="sidebar-link">2.1 定义</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/JavaScript/04.JavaScrip图解作用域链与闭包.html#_2-2-应用场景" class="sidebar-link">2.2 应用场景</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>进阶篇</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/views/JsGuide/JavaScript/原生JavaScript之灵魂拷问.html" class="sidebar-link">原生JavaScript之灵魂拷问</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript图解作用域链与闭包"><a href="#javascript图解作用域链与闭包" class="header-anchor">#</a> JavaScript图解作用域链与闭包</h1> <h2 id="_1-作用域与作用域链"><a href="#_1-作用域与作用域链" class="header-anchor">#</a> 1. 作用域与作用域链</h2> <p>在详细讲解作用域链之前，下面这些重要概念对理解闭包将会非常有帮助。</p> <ul><li>基础数据类型与引用数据类型</li> <li>内存空间</li> <li>垃圾回收机制</li> <li>执行上下文</li> <li>变量对象与活动对象</li></ul> <h3 id="_1-1-作用域"><a href="#_1-1-作用域" class="header-anchor">#</a> 1.1 作用域</h3> <ul><li><p>在JavaScript中，我们可以将作用域定义为一套规则，这套规则用来管理引擎如何在<strong>当前作用域以及嵌套的子作用域</strong>中根据<strong>标识符</strong>名称进行变量查找。</p> <blockquote><p>这里的标识符，指的是变量名或者函数名</p></blockquote></li> <li><p>JavaScript中只有全局作用域与函数作用域，当然还有<code>eval</code>，这里不讨论。</p></li> <li><p>作用域与执行上下文是完全不同的两个概念。我知道很多人会混淆他们，但是一定要仔细区分。</p> <blockquote><p>JavaScript代码的整个执行过程，分为两个阶段，代码编译阶段与代码执行阶段。编译阶段由编译器完成，将代码翻译成可执行代码，这个阶段作用域规则会确定。执行阶段由引擎完成，主要任务是执行可执行代码，执行上下文在这个阶段创建。</p></blockquote></li></ul> <p><img src="/assets/img/599584-c850e91b12e88831.60c9136a.png" alt=""></p> <h3 id="_1-2-作用域链"><a href="#_1-2-作用域链" class="header-anchor">#</a> 1.2 作用域链</h3> <p>执行上下文的生命周期，如下图：</p> <p><img src="/assets/img/599584-391af3aad043c028.5f490905.png" alt=""></p> <p>我们发现，作用域链是在执行上下文的<strong>创建阶段</strong>生成的。这个就奇怪了。上面我们刚刚说<strong>作用域在编译阶段确定规则</strong>，可是为什么作用域链却在执行阶段确定呢？</p> <p>之所有有这个疑问，是因为大家对作用域和作用域链有一个误解。我们上面说了， <strong>作用域是一套规则，那么作用域链是什么呢？是这套规则的具体实现。</strong> 所以这就是作用域与作用域链的关系，相信大家都应该明白了吧。</p> <p>我们知道函数在调用激活时，会开始创建对应的执行上下文，在执行上下文生成的过程中，变量对象，作用域链，以及<code>this</code>的值会分别被确定。之前一篇文章我们详细说明了变量对象，而这里，我们将详细说明作用域链。</p> <p><strong>作用域链，是由当前环境与上层环境的一系列变量对象组成，它保证了当前执行环境对符合访问权限的变量和函数的有序访问。</strong></p> <p>为了帮助大家理解作用域链，我们先结合一个例子，以及相应的图示来说明。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> b <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">innerTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> b <span class="token operator">+</span> c<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token function">innerTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在上面的例子中，全局，函数test，函数<code>innerTest</code>的执行上下文先后创建。我们设定他们的变量对象分别为<code>VO(global)</code>，<code>VO(test)</code>, <code>VO(innerTest)</code>。而<code>innerTest</code>的作用域链，则同时包含了这三个变量对象，所以<code>innerTest</code>的执行上下文可如下表示。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>innerTestEC <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token constant">VO</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// 变量对象</span>
    <span class="token literal-property property">scopeChain</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">VO</span><span class="token punctuation">(</span>innerTest<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">VO</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token constant">VO</span><span class="token punctuation">(</span>global<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 作用域链</span>
    <span class="token keyword">this</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>是的，你没有看错，我们可以直接用一个数组来表示作用域链，数组的第一项<code>scopeChain[0]</code>为作用域链的最前端，而数组的最后一项，为作用域链的最末端，所有的最末端都为全局变量对象。</p> <p>很多人会误解为当前作用域与上层作用域为包含关系，但其实并不是。以最前端为起点，最末端为终点的单方向通道我认为是更加贴切的形容。如图。</p> <p><img src="/assets/img/599584-b5e7e00de7c9213a.3e7c644f.png" alt=""></p> <blockquote><p>注意，因为变量对象在执行上下文进入执行阶段时，就变成了活动对象，即VO -&gt;  AO，因此图中使用了AO来表示。Active Object</p></blockquote> <p>是的，作用域链是由一系列变量对象组成，我们可以在这个单向通道中，查询变量对象中的标识符，这样就可以访问到上一层作用域中的变量了。</p> <h2 id="_2-闭包"><a href="#_2-闭包" class="header-anchor">#</a> 2. 闭包</h2> <h3 id="_2-1-定义"><a href="#_2-1-定义" class="header-anchor">#</a> 2.1 定义</h3> <p>对于那些有一点 JavaScript 使用经验但从未真正理解闭包概念的人来说，理解闭包可以看作是某种意义上的重生，突破闭包的瓶颈可以使你功力大增。</p> <ul><li>闭包与作用域链息息相关；</li> <li>闭包是在函数执行过程中被确认。</li></ul> <p>先直截了当的抛出闭包的定义： <strong>当函数可以记住并访问所在的作用域(全局作用域除外)时，就产生了闭包，即使函数是在当前作用域之外执行。</strong></p> <blockquote><p>简单来说，假设函数A在函数B的内部进行定义了，并且当函数A在执行时，访问了函数B内部的变量对象，那么B就是一个闭包。</p></blockquote> <p>关于垃圾回收机制，有一个重要的行为，那就是， <strong>当一个值，在内存中失去引用时，垃圾回收机制会根据特殊的算法找到它，并将其回收，释放内存。</strong></p> <p>而我们知道，函数的执行上下文，在执行完毕之后，生命周期结束，那么该函数的执行上下文就会失去引用。其占用的内存空间很快就会被垃圾回收器释放。<strong>可是闭包的存在，会阻止这一过程。</strong></p> <p>先来一个简单的例子。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">innnerFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    fn <span class="token operator">=</span> innnerFoo<span class="token punctuation">;</span> <span class="token comment">// 将 innnerFoo的引用，赋值给全局变量中的fn</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 此处的保留的innerFoo的引用</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 2</span>
</code></pre></div><p>在上面的例子中，<code>foo()</code>执行完毕之后，按照常理，其执行环境生命周期会结束，所占内存被垃圾收集器释放。但是通过<code>fn = innerFoo</code>，函数<code>innerFoo</code>的引用被保留了下来，复制给了全局变量<code>fn</code>。这个行为，导致了<code>foo</code>的变量对象，也被保留了下来。于是，函数<code>fn</code>在函数<code>bar</code>内部执行时，依然可以访问这个被保留下来的变量对象。所以此刻仍然能够访问到变量<code>a</code>的值。这样，我们就可以称<code>foo</code>为 <strong>闭包</strong> 。</p> <p>下图展示了闭包<code>fn</code>的作用域链。</p> <p><img src="/assets/img/599584-aacdb7b7ba2468da.917008cc.png" alt=""></p> <p>我们可以在chrome浏览器的开发者工具中查看这段代码运行时产生的函数调用栈与作用域链的生成情况。如下图。</p> <p><img src="/assets/img/599584-75ba724cb9e19b51.ece5d21c.png" alt=""></p> <p>从图中可以看出，<code>chrome</code>浏览器认为闭包是<code>foo</code>，而不是通常我们认为的<code>innerFoo</code></p> <p>在上面的图中，红色箭头所指的正是闭包。其中<code>Call Stack</code>为当前的函数调用栈，<code>Scope</code>为当前正在被执行的函数的作用域链，<code>Local</code>为当前的局部变量。</p> <p>所以，通过闭包，我们可以在其他的执行上下文中，访问到函数的内部变量。比如在上面的例子中，我们在函数<code>bar</code>的执行环境中访问到了函数<code>foo</code>的<code>a</code>变量。</p> <p>个人认为，从应用层面，这是闭包最重要的特性。利用这个特性，我们可以实现很多有意思的东西。</p> <p>不过需要注意的是， <strong>虽然例子中的闭包被保存在了全局变量中，但是闭包的作用域链并不会发生任何改变。在闭包中，能访问到的变量，仍然是作用域链上能够查询到的变量。</strong></p> <p>对上面的例子稍作修改，如果我们在函数<code>bar</code>中声明一个变量<code>c</code>，并在闭包<code>fn</code>中试图访问该变量，运行结果会抛出错误。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">innnerFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在这里，试图访问函数bar中的c变量，会抛出错误</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    fn <span class="token operator">=</span> innnerFoo<span class="token punctuation">;</span> <span class="token comment">// 将 innnerFoo的引用，赋值给全局变量中的fn</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
    <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 此处的保留的innerFoo的引用</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-2-应用场景"><a href="#_2-2-应用场景" class="header-anchor">#</a> 2.2 应用场景</h3> <p>接下来，我们来总结下，闭包的常用场景。</p> <ul><li>延迟函数<code>setTimeout</code></li></ul> <p>我们知道<code>setTimeout</code>的第一个参数是一个函数，第二个参数则是延迟的时间。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'this is test.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> timer <span class="token operator">=</span>  <span class="token function">setTimeout</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* 输出结果：
Timeout {
  _idleTimeout: 1000,
  _idlePrev: [TimersList],
  _idleNext: [TimersList],
  _idleStart: 23,
  _onTimeout: [Function: fn],
  _timerArgs: undefined,
  _repeat: null,
  _destroyed: false,
  [Symbol(refed)]: true,
  [Symbol(kHasPrimitive)]: false,
  [Symbol(asyncId)]: 2,
  [Symbol(triggerId)]: 1
}
this is test.
*/</span>
</code></pre></div><p>执行上面的代码，变量<code>timer</code>的值，会立即输出出来，表示<code>setTimeout</code>这个函数本身已经执行完毕了。但是一秒钟之后，<code>fn</code>才会被执行。这是为什么？</p> <p>按道理来说，既然<code>fn</code>被作为参数传入了<code>setTimeout</code>中，那么<code>fn</code>将会被保存在<code>setTimeout</code>变量对象中，<code>setTimeout</code>执行完毕之后，它的变量对象也就不存在了。可是事实上并不是这样。 <strong>至少在这一秒钟的事件里，它仍然是存在的。这正是因为闭包。</strong></p> <p>很显然，这是在函数的内部实现中，<code>setTimeout</code>通过特殊的方式，保留了<code>fn</code>的引用，让<code>setTimeout</code>的变量对象，并没有在其执行完毕后被垃圾收集器回收。因此<code>setTimeout</code>执行结束后一秒，我们任然能够执行<code>fn</code>函数。</p> <ul><li>柯里化</li></ul> <p>在函数式编程中，利用闭包能够实现很多炫酷的功能，柯里化算是其中一种。</p> <ul><li>模块</li></ul> <p>模块是闭包最强大的一个应用场景。看下面代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> num1 <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>num1 <span class="token operator">?</span> num1 <span class="token operator">:</span> a<span class="token punctuation">;</span>
        <span class="token keyword">var</span> num2 <span class="token operator">=</span> <span class="token operator">!</span><span class="token operator">!</span>num2 <span class="token operator">?</span> num2 <span class="token operator">:</span> b<span class="token punctuation">;</span>

        <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    window<span class="token punctuation">.</span>add <span class="token operator">=</span> add<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在上面的例子中，我使用立即执行函数的方式，创建了一个模块。方法<code>add</code>被作为一个闭包，对外暴露了一个公共方法。而变量<code>a</code>，<code>b</code>被作为私有变量。在面向对象的开发中，我们常常需要考虑是将变量作为私有变量，还是放在构造函数中的<code>this</code>中，因此理解闭包，以及原型链是一个非常重要的事情。</p> <p><img src="/assets/img/599584-147ebb03cacc6609.e402284c.png" alt=""></p> <p>此图中可以观看到当代码执行到<code>add</code>方法时的调用栈与作用域链，此刻的闭包为外层的自执行函数。</p> <p>再来看下面例子，加深对闭包的理解。</p> <p>利用闭包，修改下面的代码，让循环输出的结果依次为1， 2， 3， 4， 5</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
    <span class="token function">setTimeout</span><span class="token punctuation">(</span> <span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> i<span class="token operator">*</span><span class="token number">1000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>利用立即执行函数，当每次<code>for</code>循环时，把此时的变量<code>i</code>传入定时器中：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">j</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span> <span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> i<span class="token operator">*</span><span class="token number">1000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>给定时器传入第三个参数，作为<code>tm</code>函数的第一个参数：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">j</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 或：</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">tm</span><span class="token punctuation">(</span><span class="token parameter">j</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> <div align="center"><a href="https://beian.miit.gov.cn/" target="_blank"> 辽ICP备2345662205号 </a></div></main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.9183dc48.js" defer></script><script src="/assets/js/127.b6e7f39a.js" defer></script><script src="/assets/js/3.e72fa89a.js" defer></script><script src="/assets/js/13.4bad6da3.js" defer></script>
  </body>
</html>

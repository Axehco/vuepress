<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaScript | ZB-Notes</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/logo.png">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.5e6abf62.css" as="style"><link rel="preload" href="/assets/js/app.9183dc48.js" as="script"><link rel="preload" href="/assets/js/127.b6e7f39a.js" as="script"><link rel="preload" href="/assets/js/3.e72fa89a.js" as="script"><link rel="preload" href="/assets/js/12.b1804325.js" as="script"><link rel="prefetch" href="/assets/js/10.f535fde6.js"><link rel="prefetch" href="/assets/js/100.e585abcd.js"><link rel="prefetch" href="/assets/js/101.6d6cd206.js"><link rel="prefetch" href="/assets/js/102.0f68514e.js"><link rel="prefetch" href="/assets/js/103.73bf1d07.js"><link rel="prefetch" href="/assets/js/104.1213fe0e.js"><link rel="prefetch" href="/assets/js/105.9ab30de4.js"><link rel="prefetch" href="/assets/js/106.1cbe6d63.js"><link rel="prefetch" href="/assets/js/107.2483e919.js"><link rel="prefetch" href="/assets/js/108.2766d961.js"><link rel="prefetch" href="/assets/js/109.1f3955c2.js"><link rel="prefetch" href="/assets/js/11.83d0f9f6.js"><link rel="prefetch" href="/assets/js/110.65a66cdd.js"><link rel="prefetch" href="/assets/js/111.3a238953.js"><link rel="prefetch" href="/assets/js/112.878d17ae.js"><link rel="prefetch" href="/assets/js/113.191fbad8.js"><link rel="prefetch" href="/assets/js/114.fe1ac853.js"><link rel="prefetch" href="/assets/js/115.04dea7fa.js"><link rel="prefetch" href="/assets/js/116.c71ae24e.js"><link rel="prefetch" href="/assets/js/117.5272491f.js"><link rel="prefetch" href="/assets/js/118.e9c0c460.js"><link rel="prefetch" href="/assets/js/119.f13a2931.js"><link rel="prefetch" href="/assets/js/120.75161273.js"><link rel="prefetch" href="/assets/js/121.bfa4e3fa.js"><link rel="prefetch" href="/assets/js/122.c9818133.js"><link rel="prefetch" href="/assets/js/123.e6ae57c8.js"><link rel="prefetch" href="/assets/js/124.c6018a46.js"><link rel="prefetch" href="/assets/js/125.94c7e660.js"><link rel="prefetch" href="/assets/js/126.e366f522.js"><link rel="prefetch" href="/assets/js/128.1904509d.js"><link rel="prefetch" href="/assets/js/129.13ee7539.js"><link rel="prefetch" href="/assets/js/13.4bad6da3.js"><link rel="prefetch" href="/assets/js/130.93d5face.js"><link rel="prefetch" href="/assets/js/131.0b84a187.js"><link rel="prefetch" href="/assets/js/132.72ddaf00.js"><link rel="prefetch" href="/assets/js/133.25bbd8dd.js"><link rel="prefetch" href="/assets/js/134.620c7d90.js"><link rel="prefetch" href="/assets/js/135.43d15dff.js"><link rel="prefetch" href="/assets/js/136.e4d04b15.js"><link rel="prefetch" href="/assets/js/137.be580e6e.js"><link rel="prefetch" href="/assets/js/138.1d78c10f.js"><link rel="prefetch" href="/assets/js/139.f4a39cf9.js"><link rel="prefetch" href="/assets/js/14.be8db819.js"><link rel="prefetch" href="/assets/js/140.566d1afc.js"><link rel="prefetch" href="/assets/js/141.07f40500.js"><link rel="prefetch" href="/assets/js/142.3dde80c6.js"><link rel="prefetch" href="/assets/js/143.118e79a3.js"><link rel="prefetch" href="/assets/js/144.795265a0.js"><link rel="prefetch" href="/assets/js/145.32b11f27.js"><link rel="prefetch" href="/assets/js/146.5ce35f0e.js"><link rel="prefetch" href="/assets/js/147.abbead64.js"><link rel="prefetch" href="/assets/js/148.b0e65634.js"><link rel="prefetch" href="/assets/js/149.167aefc5.js"><link rel="prefetch" href="/assets/js/15.3f0a639b.js"><link rel="prefetch" href="/assets/js/150.1a9f807a.js"><link rel="prefetch" href="/assets/js/151.c352c805.js"><link rel="prefetch" href="/assets/js/152.b1460d3d.js"><link rel="prefetch" href="/assets/js/153.4cfc2dd9.js"><link rel="prefetch" href="/assets/js/154.fa4dfd51.js"><link rel="prefetch" href="/assets/js/155.1c5defc6.js"><link rel="prefetch" href="/assets/js/156.b612970e.js"><link rel="prefetch" href="/assets/js/157.4e9a7d54.js"><link rel="prefetch" href="/assets/js/158.5d70bcc9.js"><link rel="prefetch" href="/assets/js/159.c7aa3a8b.js"><link rel="prefetch" href="/assets/js/16.430cd672.js"><link rel="prefetch" href="/assets/js/160.1a603b72.js"><link rel="prefetch" href="/assets/js/161.47beeba8.js"><link rel="prefetch" href="/assets/js/162.2f8a82b4.js"><link rel="prefetch" href="/assets/js/163.50ea2122.js"><link rel="prefetch" href="/assets/js/164.318f0648.js"><link rel="prefetch" href="/assets/js/165.5285f26c.js"><link rel="prefetch" href="/assets/js/166.83f5037d.js"><link rel="prefetch" href="/assets/js/167.855c525e.js"><link rel="prefetch" href="/assets/js/168.77e0f1d6.js"><link rel="prefetch" href="/assets/js/169.90de0f79.js"><link rel="prefetch" href="/assets/js/17.743c2cbb.js"><link rel="prefetch" href="/assets/js/170.955ad965.js"><link rel="prefetch" href="/assets/js/171.fbef02a5.js"><link rel="prefetch" href="/assets/js/172.27ecc0c2.js"><link rel="prefetch" href="/assets/js/173.85f0edad.js"><link rel="prefetch" href="/assets/js/174.2c3c0b30.js"><link rel="prefetch" href="/assets/js/175.4ba8cf06.js"><link rel="prefetch" href="/assets/js/176.8a7531f1.js"><link rel="prefetch" href="/assets/js/177.acf2ad52.js"><link rel="prefetch" href="/assets/js/178.81cdfa8d.js"><link rel="prefetch" href="/assets/js/179.bf472f77.js"><link rel="prefetch" href="/assets/js/18.95b2960e.js"><link rel="prefetch" href="/assets/js/180.fae6a0c8.js"><link rel="prefetch" href="/assets/js/181.f8e6ca70.js"><link rel="prefetch" href="/assets/js/182.7f9c3a9b.js"><link rel="prefetch" href="/assets/js/183.a8415dbe.js"><link rel="prefetch" href="/assets/js/184.233dbc14.js"><link rel="prefetch" href="/assets/js/185.4e879e98.js"><link rel="prefetch" href="/assets/js/186.e507c02f.js"><link rel="prefetch" href="/assets/js/187.6f0c4fa0.js"><link rel="prefetch" href="/assets/js/188.ca1a265c.js"><link rel="prefetch" href="/assets/js/189.6f8465e6.js"><link rel="prefetch" href="/assets/js/19.22ca969f.js"><link rel="prefetch" href="/assets/js/190.d0b57012.js"><link rel="prefetch" href="/assets/js/191.586fe3a2.js"><link rel="prefetch" href="/assets/js/192.2071d885.js"><link rel="prefetch" href="/assets/js/193.cfca6bdf.js"><link rel="prefetch" href="/assets/js/194.dd719e16.js"><link rel="prefetch" href="/assets/js/195.e8a42785.js"><link rel="prefetch" href="/assets/js/196.b7b21fd3.js"><link rel="prefetch" href="/assets/js/197.7c47d798.js"><link rel="prefetch" href="/assets/js/198.1de68f2f.js"><link rel="prefetch" href="/assets/js/199.7970a3cb.js"><link rel="prefetch" href="/assets/js/2.a1801f46.js"><link rel="prefetch" href="/assets/js/20.3a587807.js"><link rel="prefetch" href="/assets/js/200.b5388931.js"><link rel="prefetch" href="/assets/js/201.5fa67630.js"><link rel="prefetch" href="/assets/js/202.5c5efa95.js"><link rel="prefetch" href="/assets/js/203.29cdcf27.js"><link rel="prefetch" href="/assets/js/204.7d7de884.js"><link rel="prefetch" href="/assets/js/205.5ccd9f5f.js"><link rel="prefetch" href="/assets/js/206.7407d960.js"><link rel="prefetch" href="/assets/js/207.c0ae912e.js"><link rel="prefetch" href="/assets/js/208.689708f2.js"><link rel="prefetch" href="/assets/js/209.13cd9f38.js"><link rel="prefetch" href="/assets/js/21.88790cdd.js"><link rel="prefetch" href="/assets/js/210.0cc4ecd9.js"><link rel="prefetch" href="/assets/js/211.c9e2c59e.js"><link rel="prefetch" href="/assets/js/212.debf74f9.js"><link rel="prefetch" href="/assets/js/213.cc3953fc.js"><link rel="prefetch" href="/assets/js/214.43b2fe42.js"><link rel="prefetch" href="/assets/js/215.22f95420.js"><link rel="prefetch" href="/assets/js/216.2ced123c.js"><link rel="prefetch" href="/assets/js/217.82ad5303.js"><link rel="prefetch" href="/assets/js/218.ed9c052c.js"><link rel="prefetch" href="/assets/js/219.c957bee2.js"><link rel="prefetch" href="/assets/js/22.b9407d63.js"><link rel="prefetch" href="/assets/js/220.08e415f9.js"><link rel="prefetch" href="/assets/js/221.af35a579.js"><link rel="prefetch" href="/assets/js/222.76eef6f2.js"><link rel="prefetch" href="/assets/js/223.f6997158.js"><link rel="prefetch" href="/assets/js/224.0177e6bf.js"><link rel="prefetch" href="/assets/js/225.6c1809be.js"><link rel="prefetch" href="/assets/js/226.7f325c5e.js"><link rel="prefetch" href="/assets/js/227.3934aeaa.js"><link rel="prefetch" href="/assets/js/228.14147f23.js"><link rel="prefetch" href="/assets/js/229.949e1c15.js"><link rel="prefetch" href="/assets/js/23.1d784e73.js"><link rel="prefetch" href="/assets/js/230.3eaa7849.js"><link rel="prefetch" href="/assets/js/231.71a12a2b.js"><link rel="prefetch" href="/assets/js/232.04245fd7.js"><link rel="prefetch" href="/assets/js/233.cb93897a.js"><link rel="prefetch" href="/assets/js/234.0e51f40d.js"><link rel="prefetch" href="/assets/js/235.3cdf817c.js"><link rel="prefetch" href="/assets/js/236.a05a80c2.js"><link rel="prefetch" href="/assets/js/237.6c626852.js"><link rel="prefetch" href="/assets/js/238.1fb1e7af.js"><link rel="prefetch" href="/assets/js/239.25580979.js"><link rel="prefetch" href="/assets/js/24.4d1bcce6.js"><link rel="prefetch" href="/assets/js/240.ffccca7f.js"><link rel="prefetch" href="/assets/js/241.23ca8802.js"><link rel="prefetch" href="/assets/js/242.71fadb4d.js"><link rel="prefetch" href="/assets/js/243.ff1e3883.js"><link rel="prefetch" href="/assets/js/244.ded9c1e0.js"><link rel="prefetch" href="/assets/js/245.747075b9.js"><link rel="prefetch" href="/assets/js/246.68ec5c76.js"><link rel="prefetch" href="/assets/js/247.1e29c1ca.js"><link rel="prefetch" href="/assets/js/248.9eb4b80c.js"><link rel="prefetch" href="/assets/js/249.2edc7b76.js"><link rel="prefetch" href="/assets/js/25.890f46ae.js"><link rel="prefetch" href="/assets/js/250.af69f0bc.js"><link rel="prefetch" href="/assets/js/251.0d1e8c08.js"><link rel="prefetch" href="/assets/js/252.e15d765f.js"><link rel="prefetch" href="/assets/js/253.bab38f4c.js"><link rel="prefetch" href="/assets/js/254.b177cab1.js"><link rel="prefetch" href="/assets/js/255.e634566d.js"><link rel="prefetch" href="/assets/js/256.5e102d9a.js"><link rel="prefetch" href="/assets/js/257.0563503d.js"><link rel="prefetch" href="/assets/js/258.3904d8b4.js"><link rel="prefetch" href="/assets/js/259.cfa2fd70.js"><link rel="prefetch" href="/assets/js/26.d90819c7.js"><link rel="prefetch" href="/assets/js/260.ba21761f.js"><link rel="prefetch" href="/assets/js/261.54cdb61b.js"><link rel="prefetch" href="/assets/js/262.92f444b6.js"><link rel="prefetch" href="/assets/js/263.573d714e.js"><link rel="prefetch" href="/assets/js/264.3f022b6f.js"><link rel="prefetch" href="/assets/js/265.77f16fb3.js"><link rel="prefetch" href="/assets/js/266.3831dc5c.js"><link rel="prefetch" href="/assets/js/267.0725e50d.js"><link rel="prefetch" href="/assets/js/268.838f91ac.js"><link rel="prefetch" href="/assets/js/269.b4abdb5b.js"><link rel="prefetch" href="/assets/js/27.ea129088.js"><link rel="prefetch" href="/assets/js/270.9c3fabe7.js"><link rel="prefetch" href="/assets/js/271.fed379bf.js"><link rel="prefetch" href="/assets/js/272.72f8b02f.js"><link rel="prefetch" href="/assets/js/273.39cfb9c8.js"><link rel="prefetch" href="/assets/js/274.1590ebff.js"><link rel="prefetch" href="/assets/js/275.f9d8055f.js"><link rel="prefetch" href="/assets/js/276.f07513c5.js"><link rel="prefetch" href="/assets/js/277.c62e2eea.js"><link rel="prefetch" href="/assets/js/278.64fca9d3.js"><link rel="prefetch" href="/assets/js/279.172b18bc.js"><link rel="prefetch" href="/assets/js/28.cbeb58aa.js"><link rel="prefetch" href="/assets/js/280.ac4a96fc.js"><link rel="prefetch" href="/assets/js/281.c31ad5da.js"><link rel="prefetch" href="/assets/js/282.8fa7ef0b.js"><link rel="prefetch" href="/assets/js/283.81f8c403.js"><link rel="prefetch" href="/assets/js/284.edf45079.js"><link rel="prefetch" href="/assets/js/285.75c3bc82.js"><link rel="prefetch" href="/assets/js/286.c17b0350.js"><link rel="prefetch" href="/assets/js/287.447122aa.js"><link rel="prefetch" href="/assets/js/288.ed6f0804.js"><link rel="prefetch" href="/assets/js/289.e614c4c2.js"><link rel="prefetch" href="/assets/js/29.e3f5a936.js"><link rel="prefetch" href="/assets/js/290.94677db6.js"><link rel="prefetch" href="/assets/js/291.aa295671.js"><link rel="prefetch" href="/assets/js/292.ff765b29.js"><link rel="prefetch" href="/assets/js/293.70c698af.js"><link rel="prefetch" href="/assets/js/294.065a8d5f.js"><link rel="prefetch" href="/assets/js/295.b2ba8b22.js"><link rel="prefetch" href="/assets/js/296.98e9da73.js"><link rel="prefetch" href="/assets/js/297.d40414ae.js"><link rel="prefetch" href="/assets/js/298.f10fcd53.js"><link rel="prefetch" href="/assets/js/299.2099838a.js"><link rel="prefetch" href="/assets/js/30.6d703dcc.js"><link rel="prefetch" href="/assets/js/300.0cfc5419.js"><link rel="prefetch" href="/assets/js/301.509df13a.js"><link rel="prefetch" href="/assets/js/302.8be07830.js"><link rel="prefetch" href="/assets/js/303.a7726893.js"><link rel="prefetch" href="/assets/js/304.2e65243e.js"><link rel="prefetch" href="/assets/js/305.d0fd2016.js"><link rel="prefetch" href="/assets/js/306.9358c58b.js"><link rel="prefetch" href="/assets/js/307.00a40dbc.js"><link rel="prefetch" href="/assets/js/308.0438a7f0.js"><link rel="prefetch" href="/assets/js/309.6b3c1328.js"><link rel="prefetch" href="/assets/js/31.5211ec4a.js"><link rel="prefetch" href="/assets/js/310.41250083.js"><link rel="prefetch" href="/assets/js/311.0b0e824f.js"><link rel="prefetch" href="/assets/js/312.e8b819be.js"><link rel="prefetch" href="/assets/js/313.7c0fed90.js"><link rel="prefetch" href="/assets/js/314.37c71cbe.js"><link rel="prefetch" href="/assets/js/315.3a90afe5.js"><link rel="prefetch" href="/assets/js/316.07befc59.js"><link rel="prefetch" href="/assets/js/317.0f1b0e41.js"><link rel="prefetch" href="/assets/js/318.6162c92c.js"><link rel="prefetch" href="/assets/js/319.53ba4545.js"><link rel="prefetch" href="/assets/js/32.79740f13.js"><link rel="prefetch" href="/assets/js/320.d5d02efc.js"><link rel="prefetch" href="/assets/js/321.90202c35.js"><link rel="prefetch" href="/assets/js/322.d5c1127c.js"><link rel="prefetch" href="/assets/js/323.2fb0d163.js"><link rel="prefetch" href="/assets/js/324.594f9a05.js"><link rel="prefetch" href="/assets/js/325.64f88b7d.js"><link rel="prefetch" href="/assets/js/326.34d03ceb.js"><link rel="prefetch" href="/assets/js/327.b5409c78.js"><link rel="prefetch" href="/assets/js/328.4ee96a7c.js"><link rel="prefetch" href="/assets/js/329.00543f24.js"><link rel="prefetch" href="/assets/js/33.3213dc4d.js"><link rel="prefetch" href="/assets/js/330.91ba9a82.js"><link rel="prefetch" href="/assets/js/331.e534dcdd.js"><link rel="prefetch" href="/assets/js/332.528190d6.js"><link rel="prefetch" href="/assets/js/34.0479cfea.js"><link rel="prefetch" href="/assets/js/35.62844ca7.js"><link rel="prefetch" href="/assets/js/36.797dbe09.js"><link rel="prefetch" href="/assets/js/37.639f1289.js"><link rel="prefetch" href="/assets/js/38.0d4198c2.js"><link rel="prefetch" href="/assets/js/39.c511da8b.js"><link rel="prefetch" href="/assets/js/4.a2b19b6e.js"><link rel="prefetch" href="/assets/js/40.91d2bca7.js"><link rel="prefetch" href="/assets/js/41.acf4a677.js"><link rel="prefetch" href="/assets/js/42.8f5d5bc1.js"><link rel="prefetch" href="/assets/js/43.29b762dc.js"><link rel="prefetch" href="/assets/js/44.cd266de3.js"><link rel="prefetch" href="/assets/js/45.450c93e8.js"><link rel="prefetch" href="/assets/js/46.1d691666.js"><link rel="prefetch" href="/assets/js/47.f7d0003c.js"><link rel="prefetch" href="/assets/js/48.a2231eff.js"><link rel="prefetch" href="/assets/js/49.874f53aa.js"><link rel="prefetch" href="/assets/js/5.e15a2319.js"><link rel="prefetch" href="/assets/js/50.e57c1303.js"><link rel="prefetch" href="/assets/js/51.0fa4b883.js"><link rel="prefetch" href="/assets/js/52.ea768dd9.js"><link rel="prefetch" href="/assets/js/53.beb2c29a.js"><link rel="prefetch" href="/assets/js/54.95c3d237.js"><link rel="prefetch" href="/assets/js/55.00fd38bb.js"><link rel="prefetch" href="/assets/js/56.0650ec4c.js"><link rel="prefetch" href="/assets/js/57.cd6a07b0.js"><link rel="prefetch" href="/assets/js/58.385f2dd8.js"><link rel="prefetch" href="/assets/js/59.83522701.js"><link rel="prefetch" href="/assets/js/6.10cb9ffe.js"><link rel="prefetch" href="/assets/js/60.982f805f.js"><link rel="prefetch" href="/assets/js/61.d439affb.js"><link rel="prefetch" href="/assets/js/62.ceb8712f.js"><link rel="prefetch" href="/assets/js/63.736dbe70.js"><link rel="prefetch" href="/assets/js/64.bd7d2c0f.js"><link rel="prefetch" href="/assets/js/65.3202694b.js"><link rel="prefetch" href="/assets/js/66.ed7ca341.js"><link rel="prefetch" href="/assets/js/67.45c8b959.js"><link rel="prefetch" href="/assets/js/68.4de44aad.js"><link rel="prefetch" href="/assets/js/69.0df14048.js"><link rel="prefetch" href="/assets/js/7.538173c9.js"><link rel="prefetch" href="/assets/js/70.d178ec66.js"><link rel="prefetch" href="/assets/js/71.5f2b73dd.js"><link rel="prefetch" href="/assets/js/72.1499eade.js"><link rel="prefetch" href="/assets/js/73.39378169.js"><link rel="prefetch" href="/assets/js/74.aab9f4cd.js"><link rel="prefetch" href="/assets/js/75.58af5dcb.js"><link rel="prefetch" href="/assets/js/76.ddebe4de.js"><link rel="prefetch" href="/assets/js/77.795376b5.js"><link rel="prefetch" href="/assets/js/78.9d59b408.js"><link rel="prefetch" href="/assets/js/79.a48d3c50.js"><link rel="prefetch" href="/assets/js/8.5f0cbc1e.js"><link rel="prefetch" href="/assets/js/80.56981d9a.js"><link rel="prefetch" href="/assets/js/81.a177e7bb.js"><link rel="prefetch" href="/assets/js/82.13486971.js"><link rel="prefetch" href="/assets/js/83.89195269.js"><link rel="prefetch" href="/assets/js/84.3ef3070c.js"><link rel="prefetch" href="/assets/js/85.a0af9b6c.js"><link rel="prefetch" href="/assets/js/86.ec91bf6b.js"><link rel="prefetch" href="/assets/js/87.5d4eb344.js"><link rel="prefetch" href="/assets/js/88.e6f8ec26.js"><link rel="prefetch" href="/assets/js/89.24c96fbd.js"><link rel="prefetch" href="/assets/js/9.b8c9c0ed.js"><link rel="prefetch" href="/assets/js/90.a6a15ea3.js"><link rel="prefetch" href="/assets/js/91.3386a314.js"><link rel="prefetch" href="/assets/js/92.b2be18b1.js"><link rel="prefetch" href="/assets/js/93.9afe721c.js"><link rel="prefetch" href="/assets/js/94.6cb996fc.js"><link rel="prefetch" href="/assets/js/95.e28a0e9b.js"><link rel="prefetch" href="/assets/js/96.187bf387.js"><link rel="prefetch" href="/assets/js/97.bc059528.js"><link rel="prefetch" href="/assets/js/98.bad8f1e3.js"><link rel="prefetch" href="/assets/js/99.8812ae44.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5e6abf62.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/homepic.gif" alt="ZB-Notes" class="logo"> <span class="site-name can-hide">ZB-Notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/Algorithm/LeetCode/" class="nav-link">
  Leetcode 题解
</a></li><li class="dropdown-item"><!----> <a href="/views/Algorithm/JZOffer/" class="nav-link">
  剑指 Offer 题解
</a></li><li class="dropdown-item"><!----> <a href="/views/Algorithm/PTA/PATBasicLevelPractice/" class="nav-link">
  PAT Basic Level Practice
</a></li><li class="dropdown-item"><!----> <a href="/views/Algorithm/PTA/PythonPractice/" class="nav-link">
  浙大版Python程序设计题目集
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端八股文" class="dropdown-title"><span class="title">前端八股文</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端八股文" class="mobile-dropdown-title"><span class="title">前端八股文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/JsGuide/JavaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/views/JsGuide/Interview/" class="nav-link">
  高频面经
</a></li><li class="dropdown-item"><!----> <a href="/views/JsGuide/InterviewGuide/" class="nav-link router-link-active">
  其他面经
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="WebPack" class="dropdown-title"><span class="title">WebPack</span> <span class="arrow down"></span></button> <button type="button" aria-label="WebPack" class="mobile-dropdown-title"><span class="title">WebPack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/intro/" class="nav-link">
  介绍
</a></li><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/base/" class="nav-link">
  基础配置
</a></li><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/senior/" class="nav-link">
  高级优化
</a></li><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/project/" class="nav-link">
  项目配置
</a></li><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/origin/" class="nav-link">
  原理分析
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/Vue/VueNotes/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/views/Vue/VueProject/" class="nav-link">
  项目
</a></li></ul></div></div><div class="nav-item"><a href="/views/Java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/views/DesignPattern/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="https://github.com/Axehco" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/Algorithm/LeetCode/" class="nav-link">
  Leetcode 题解
</a></li><li class="dropdown-item"><!----> <a href="/views/Algorithm/JZOffer/" class="nav-link">
  剑指 Offer 题解
</a></li><li class="dropdown-item"><!----> <a href="/views/Algorithm/PTA/PATBasicLevelPractice/" class="nav-link">
  PAT Basic Level Practice
</a></li><li class="dropdown-item"><!----> <a href="/views/Algorithm/PTA/PythonPractice/" class="nav-link">
  浙大版Python程序设计题目集
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端八股文" class="dropdown-title"><span class="title">前端八股文</span> <span class="arrow down"></span></button> <button type="button" aria-label="前端八股文" class="mobile-dropdown-title"><span class="title">前端八股文</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/JsGuide/JavaScript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/views/JsGuide/Interview/" class="nav-link">
  高频面经
</a></li><li class="dropdown-item"><!----> <a href="/views/JsGuide/InterviewGuide/" class="nav-link router-link-active">
  其他面经
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="WebPack" class="dropdown-title"><span class="title">WebPack</span> <span class="arrow down"></span></button> <button type="button" aria-label="WebPack" class="mobile-dropdown-title"><span class="title">WebPack</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/intro/" class="nav-link">
  介绍
</a></li><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/base/" class="nav-link">
  基础配置
</a></li><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/senior/" class="nav-link">
  高级优化
</a></li><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/project/" class="nav-link">
  项目配置
</a></li><li class="dropdown-item"><!----> <a href="/views/WebPackNotes/origin/" class="nav-link">
  原理分析
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Vue" class="dropdown-title"><span class="title">Vue</span> <span class="arrow down"></span></button> <button type="button" aria-label="Vue" class="mobile-dropdown-title"><span class="title">Vue</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/Vue/VueNotes/" class="nav-link">
  基础
</a></li><li class="dropdown-item"><!----> <a href="/views/Vue/VueProject/" class="nav-link">
  项目
</a></li></ul></div></div><div class="nav-item"><a href="/views/Java/" class="nav-link">
  Java
</a></div><div class="nav-item"><a href="/views/DesignPattern/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><a href="https://github.com/Axehco" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/views/JsGuide/InterviewGuide/CSS.html" class="sidebar-link">CSS</a></li><li><a href="/views/JsGuide/InterviewGuide/JavaScript.html" aria-current="page" class="active sidebar-link">JavaScript</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_1-你对原型和原型链的了解有多少" class="sidebar-link">1. 你对原型和原型链的了解有多少？</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_2-如何理解作用域和作用域链" class="sidebar-link">2. 如何理解作用域和作用域链?</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_2-1-什么是作用域" class="sidebar-link">2.1 什么是作用域？</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_2-2-什么是作用域链" class="sidebar-link">2.2 什么是作用域链？</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_2-3-静态作用域与动态作用域" class="sidebar-link">2.3 静态作用域与动态作用域</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_2-4-动态作用域" class="sidebar-link">2.4 动态作用域</a></li></ul></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_3-执行上下文栈" class="sidebar-link">3. 执行上下文栈</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_3-1-顺序执行" class="sidebar-link">3.1 顺序执行</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_3-2-可执行代码" class="sidebar-link">3.2 可执行代码</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_3-3-执行上下文栈" class="sidebar-link">3.3 执行上下文栈</a></li></ul></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_4-变量对象" class="sidebar-link">4. 变量对象</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_4-1-变量对象" class="sidebar-link">4.1 变量对象</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_4-2-全局上下文" class="sidebar-link">4.2 全局上下文</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_4-3-函数上下文" class="sidebar-link">4.3 函数上下文</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_4-4-执行过程" class="sidebar-link">4.4 执行过程</a></li></ul></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_5-作用域链" class="sidebar-link">5. 作用域链</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_5-1-作用域链" class="sidebar-link">5.1 作用域链</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_5-2-函数创建" class="sidebar-link">5.2 函数创建</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_5-3-函数激活" class="sidebar-link">5.3 函数激活</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_5-4-总结" class="sidebar-link">5.4 总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_6-从ecmascript规范解读this" class="sidebar-link">6. 从ECMAScript规范解读this</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_6-1-reference-type-解读" class="sidebar-link">6.1 Reference type 解读</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_6-2-总结" class="sidebar-link">6.2 总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_7-执行上下文" class="sidebar-link">7. 执行上下文</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_7-1-具体执行分析" class="sidebar-link">7.1 具体执行分析</a></li></ul></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_8-闭包" class="sidebar-link">8. 闭包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_8-1-定义" class="sidebar-link">8.1 定义</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_8-2分析" class="sidebar-link">8.2分析</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_8-3-必刷题" class="sidebar-link">8.3 必刷题</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_8-4-闭包使用场景" class="sidebar-link">8.4 闭包使用场景</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_8-5-闭包存在什么问题" class="sidebar-link">8.5 闭包存在什么问题?</a></li></ul></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_9-bind、call、apply" class="sidebar-link">9. bind、call、apply</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_9-1-区别" class="sidebar-link">9.1 区别</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_9-2-应用场景" class="sidebar-link">9.2 应用场景</a></li></ul></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_10-数组去重" class="sidebar-link">10. 数组去重</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_10-1-普通数组去重" class="sidebar-link">10.1 普通数组去重</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_10-2-对象数组去重" class="sidebar-link">10.2 对象数组去重</a></li></ul></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_11-对给定数组求最大值" class="sidebar-link">11. 对给定数组求最大值</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_12-判断数据类型的方式有哪些" class="sidebar-link">12. 判断数据类型的方式有哪些？</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_13-如何实现函数节流" class="sidebar-link">13. 如何实现函数节流？</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_14-如何实现函数防抖" class="sidebar-link">14. 如何实现函数防抖？</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_15-如何实现数组扁平化" class="sidebar-link">15. 如何实现数组扁平化？</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_16-object-defineproperty" class="sidebar-link">16. Object.defineProperty</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_17-如何实现new操作符" class="sidebar-link">17. 如何实现new操作符？</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_18-如何实现bind函数" class="sidebar-link">18. 如何实现bind函数？</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_19-如何实现call和apply函数" class="sidebar-link">19. 如何实现call和apply函数？</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_20-如何实现instanceof" class="sidebar-link">20. 如何实现instanceof？</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_21-javascript数组的方法有哪些" class="sidebar-link">21. JavaScript数组的方法有哪些？</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_22-去除数组中指定的元素" class="sidebar-link">22. 去除数组中指定的元素？</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_23-栈" class="sidebar-link">23. 栈</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_24-队列" class="sidebar-link">24. 队列</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_25-let、const、var区别" class="sidebar-link">25. let、const、var区别？</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_26-箭头函数和普通函数的区别" class="sidebar-link">26. 箭头函数和普通函数的区别？</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_27-es6数组去重" class="sidebar-link">27. ES6数组去重</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_28-foreach、for-in、for-of的区别" class="sidebar-link">28. forEach、for in、for of的区别</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_29-es6中对象新增的方法有哪些" class="sidebar-link">29. ES6中对象新增的方法有哪些？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_29-1-object-is" class="sidebar-link">29.1 Object.is()</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_29-2-object-assin" class="sidebar-link">29.2 Object.assin()</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_29-3-object-keys" class="sidebar-link">29.3 Object.keys()</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_29-4-object-values" class="sidebar-link">29.4 Object.values()</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_29-5-object-entries" class="sidebar-link">29.5 Object.entries()</a></li></ul></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_30-class和function的区别" class="sidebar-link">30. class和function的区别？</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_31-promise" class="sidebar-link">31. Promise</a></li><li class="sidebar-sub-header"><a href="/views/JsGuide/InterviewGuide/JavaScript.html#_32-运算符实现原理" class="sidebar-link">32. ...运算符实现原理</a></li></ul></li><li><a href="/views/JsGuide/InterviewGuide/webpack.html" class="sidebar-link">webpack</a></li><li><a href="/views/JsGuide/InterviewGuide/设计模式.html" class="sidebar-link">设计模式</a></li><li><a href="/views/JsGuide/InterviewGuide/计算机网络.html" class="sidebar-link">计算机网络</a></li><li><a href="/views/JsGuide/InterviewGuide/浏览器.html" class="sidebar-link">浏览器</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javascript"><a href="#javascript" class="header-anchor">#</a> JavaScript</h1> <h2 id="_1-你对原型和原型链的了解有多少"><a href="#_1-你对原型和原型链的了解有多少" class="header-anchor">#</a> 1. 你对原型和原型链的了解有多少？</h2> <p><strong>简单理解：</strong> 原型链就是当我们访问对象的某个属性或方法时，如果在当前对象中找不到定义，会继续在当前对象的原型对象中查找，如果原型对象中依然没有找到，会继续在原型对象的原型中查找（原 型也是对象，也有它自己的原型）如此继续，直到找到为止，或者查找到最顶层的原型对象中也没有找到，就结束查找，返回 undefined。可以看出，这个查找过程是一个链式的查找，每个对象都有一个到它自身原型对象的链接，这些链接组件的整个链条就是原型链。拥有相同原型的多个对象，他们的共同特征正是通过这种查找模式体现出来的。</p> <p><strong>意义：</strong> 实例对象可以共享构造函数原型属性和方法, 节省内存。构造函数原型上的属性和方法越多，节省内存越大。</p> <p>我们先使用构造函数创建一个对象：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Kevin'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// Kevin</span>
</code></pre></div><p>在这个例子中，Person 就是一个构造函数，我们使用 new 创建了一个实例对象 person。</p> <ul><li><code>prototype</code></li></ul> <p>每个函数都有一个 prototype 属性，就是我们经常在各种例子中看到的那个 prototype ，比如：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token comment">// 虽然写在注释里，但是你要注意：</span>
<span class="token comment">// prototype是函数才会有的属性</span>
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Kevin'</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> person2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person1<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// Kevin</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person2<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// Kevin</span>
</code></pre></div><p>那这个函数的 prototype 属性到底指向的是什么呢？是这个函数的原型吗？</p> <p>其实，函数的 prototype 属性指向了一个对象，这个对象正是调用该构造函数而创建的<strong>实例</strong>的原型，也就是这个例子中的 person1 和 person2 的原型。</p> <p>那什么是原型呢？你可以这样理解：每一个JavaScript对象(null除外)在创建的时候就会与之关联另一个对象，这个对象就是我们所说的原型，每一个对象都会从原型&quot;继承&quot;属性。</p> <p>让我们用一张图表示构造函数和实例原型之间的关系：</p> <p><img src="/assets/img/javascript_00001.6ed311e0.png" alt="构造函数和实例原型的关系图"></p> <p>在这张图中我们用 Object.prototype 表示实例原型。</p> <p>那么我们该怎么表示实例与实例原型，也就是 person 和 Person.prototype 之间的关系呢，这时候我们就要讲到第二个属性：</p> <ul><li><code>__proto__</code></li></ul> <p>这是每一个JavaScript对象(除了 null )都具有的一个属性，叫<code>__proto__</code>，这个属性会指向该对象的原型。</p> <p>为了证明这一点，我们可以在火狐或者谷歌中输入：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>于是我们更新下关系图：</p> <p><img src="/assets/img/javascript_00002.88e97b5c.png" alt="实例与实例原型的关系图"></p> <p>既然实例对象和构造函数都可以指向原型，那么原型是否有属性指向构造函数或者实例呢？</p> <ul><li><code>constructor</code></li></ul> <p>指向实例倒是没有，因为一个构造函数可以生成多个实例，但是原型指向构造函数倒是有的，这就要讲到第三个属性：constructor，每个原型都有一个 constructor 属性指向关联的构造函数。</p> <p>为了验证这一点，我们可以尝试：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Person <span class="token operator">===</span> <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>所以再更新下关系图：</p> <p><img src="/assets/img/javascript_00003.5fa1915a.png" alt="实例原型与构造函数的关系图"></p> <p>综上我们已经得出：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>__proto__ <span class="token operator">==</span> <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">==</span> Person<span class="token punctuation">)</span> <span class="token comment">// true</span>
<span class="token comment">// 顺便学习一个ES5的方法,可以获得对象的原型</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><p>了解了构造函数、实例原型、和实例之间的关系，接下来我们讲讲实例和原型的关系：</p> <ul><li><code>实例与原型</code></li></ul> <p>当读取实例的属性时，如果找不到，就会查找与对象关联的原型中的属性，如果还查不到，就去找原型的原型，一直找到最顶层为止。</p> <p>举个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Kevin'</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

person<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Daisy'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// Daisy</span>

<span class="token keyword">delete</span> person<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// Kevin</span>
</code></pre></div><p>在这个例子中，我们给实例对象 person 添加了 name 属性，当我们打印 person.name 的时候，结果自然为 Daisy。</p> <p>但是当我们删除了 person 的 name 属性时，读取 person.name，从 person 对象中找不到 name 属性就会从 person 的原型也就是 person.<strong>proto</strong> ，也就是 Person.prototype中查找，幸运的是我们找到了 name 属性，结果为 Kevin。</p> <p>但是万一还没有找到呢？原型的原型又是什么呢？</p> <ul><li><code>原型的原型</code></li></ul> <p>在前面，我们已经讲了原型也是一个对象，既然是对象，我们就可以用最原始的方式创建它，那就是：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Kevin'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token comment">// Kevin</span>
</code></pre></div><p>其实原型对象就是通过 Object 构造函数生成的，结合之前所讲，实例的 <strong>proto</strong> 指向构造函数的 prototype ，所以我们再更新下关系图：</p> <p><img src="/assets/img/javascript_00004.33e81924.png" alt="原型的原型关系图"></p> <ul><li><code>原型链</code></li></ul> <p>那 Object.prototype 的原型呢？</p> <p>null，我们可以打印：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
</code></pre></div><p>然而 null 究竟代表了什么呢？</p> <p>引用阮一峰老师的 <a href="http://www.ruanyifeng.com/blog/2014/03/undefined-vs-null.html" target="_blank" rel="noopener noreferrer">《undefined与null的区别》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 就是：</p> <p><strong>null 表示“没有对象”，即该处不应该有值。</strong></p> <p>所以 <code>Object.prototype.__proto__</code> 的值为 null 跟 <code>Object.prototype</code> 没有原型，其实表达了一个意思。</p> <p>所以查找属性的时候查到 <code>Object.prototype</code> 就可以停止查找了。</p> <p>最后一张关系图也可以更新为：</p> <p><img src="/assets/img/javascript_00005.0eda1a47.png" alt="原型链示意图"></p> <p>顺便还要说一下，图中由相互关联的原型组成的链状结构就是原型链，也就是蓝色的这条线。</p> <ul><li><code>补充</code></li></ul> <p>首先是 constructor 属性，我们看个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Person<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre></div><p>当获取 person.constructor 时，其实 person 中并没有 constructor 属性,当不能读取到constructor 属性时，会从 person 的原型也就是 Person.prototype 中读取，正好原型中有该属性，所以：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>person<span class="token punctuation">.</span>constructor <span class="token operator">===</span> <span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor
</code></pre></div><p>其次是<code>__proto__</code> ，绝大部分浏览器都支持这个非标准的方法访问原型，然而它并不存在于 <code>Person.prototype</code> 中，实际上，它是来自于 <code>Object.prototype</code> ，与其说是一个属性，不如说是一个 <code>getter/setter</code>，当使用 <code>obj.__proto__</code> 时，可以理解成返回了 <code>Object.getPrototypeOf(obj)</code> 。</p> <p>最后是关于继承，前面我们讲到“每一个对象都会从原型‘继承’属性”，实际上，继承是一个十分具有迷惑性的说法，引用《你不知道的JavaScript》中的话，就是：</p> <p>继承意味着复制操作，然而 JavaScript 默认并不会复制对象的属性，相反，JavaScript 只是在两个对象之间创建一个关联，这样，一个对象就可以通过委托访问另一个对象的属性和函数，所以与其叫继承，委托的说法反而更准确些。</p> <h2 id="_2-如何理解作用域和作用域链"><a href="#_2-如何理解作用域和作用域链" class="header-anchor">#</a> 2. 如何理解作用域和作用域链?</h2> <p>作用域是指程序源代码中定义变量的区域。</p> <p>作用域规定了如何查找变量，也就是确定当前执行代码对变量的访问权限。</p> <p>JavaScript 采用词法作用域(lexical scoping)，也就是静态作用域。</p> <p>作用域存在的最大意义就是变量隔离，即：不同作用域下同名变量不会有冲突。</p> <h3 id="_2-1-什么是作用域"><a href="#_2-1-什么是作用域" class="header-anchor">#</a> 2.1 什么是作用域？</h3> <p>作用域是在运行时代码中的某些特定部分中变量，函数和对象的可访问性，作用域决定了代码区块中变量和其他资源的可见性。</p> <p>js中作用域主要分为：全局作用域、局部作用域、块级作用域。</p> <ul><li>全局作用域</li></ul> <p>所有 window 对象的属性拥有全局作用域。</p> <p>在最外层定义的变量、函数、及对象都有全局作用域。</p> <p><strong>所有未定义直接赋值的变量自动声明为全局作用域。</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">scope</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  globalVariable <span class="token operator">=</span> <span class="token string">'globalVariable'</span><span class="token punctuation">;</span> <span class="token comment">// 未定义直接赋值的变量</span>
<span class="token punctuation">}</span>
<span class="token function">scope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 要先调用次函数globalVariable才能被激活。</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>globalVariable<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// globalVariable</span>
</code></pre></div><p>本例子中globalVariable便是我们的未定义直接赋值的变量, 它同样具有我们全局作用域,而且我们的 globalVariable 会直接挂到 window 对象上, 虽然这种操作代码可以正常运行但却很可能会污染全局作用 域空间。一般不推荐使用。</p> <ul><li>局部作用域</li></ul> <p>局部作用域指的就是我们的函数作用域，代指函数内部的空间。函数内部空间声明的变量无法在外部访问。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> currentName <span class="token operator">=</span> <span class="token string">'xiaohong'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>currentName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// currentName is not defined</span>
</code></pre></div><ul><li>块级作用域</li></ul> <p>块级作用域是指被大括<code>{}</code>包裹住的相关联的语句的集合。例如，你可以在 if后声明一段函数块形式的代码，表明当条件判断为真时，解释程序应该运行上述函数块里的代码，或者当条件判断为假时跳 过执行上述函数块里的代码。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">{</span>
	<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>
</code></pre></div><h3 id="_2-2-什么是作用域链"><a href="#_2-2-什么是作用域链" class="header-anchor">#</a> 2.2 什么是作用域链？</h3> <p>当我们在某个函数的内部作用域中查找某个变量时, 如果没有找到就会到他的父级作用域中查找, 如果父级也没找到就会接着一层一层的向上寻找，直到找到全局作用域还是没找到的话，就宣布放弃。这种一层一层的作用域嵌套关系，就是作用域链。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">globalFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">currentFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 全局作用域的变量</span>
  <span class="token punctuation">}</span>
  <span class="token function">currentFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">globalFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如上例子中当我们在 currentFunc 中查找 a 变量的时候 当前 currentFunc 作用域不存在所以就到他的父作用域 globalFunc 中查找，同样还是没找到, 在往上就到了我们的全局作用域， 在全局作用域找到了我们需要的变量 a。 可以看到这个查找的过程就是顺着我们的作用域链层层往上的。</p> <h3 id="_2-3-静态作用域与动态作用域"><a href="#_2-3-静态作用域与动态作用域" class="header-anchor">#</a> 2.3 静态作用域与动态作用域</h3> <p>因为 JavaScript 采用的是词法作用域，函数的作用域在函数定义的时候就决定了。</p> <p>而与词法作用域相对的是动态作用域，函数的作用域是在函数调用的时候才决定的。</p> <p>让我们认真看个例子就能明白之间的区别：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 结果是 ???</span>
</code></pre></div><p>假设JavaScript采用静态作用域，分析下执行过程：</p> <p>执行 foo 函数，先从 foo 函数内部查找是否有局部变量 value，如果没有，就根据书写的位置，查找上面一层的代码，也就是 value 等于 1，所以结果会打印 1。</p> <p>假设JavaScript采用动态作用域，分析下执行过程：</p> <p>执行 foo 函数，依然是从 foo 函数内部查找是否有局部变量 value。如果没有，就从调用函数的作用域，也就是 bar 函数内部查找 value 变量，所以结果会打印 2。</p> <p>前面我们已经说了，JavaScript采用的是静态作用域，所以这个例子的结果是 1。</p> <h3 id="_2-4-动态作用域"><a href="#_2-4-动态作用域" class="header-anchor">#</a> 2.4 动态作用域</h3> <p>也许你会好奇什么语言是动态作用域？</p> <p>bash 就是动态作用域，不信的话，把下面的脚本存成例如 scope.bash，然后进入相应的目录，用命令行执行 <code>bash ./scope.bash</code>，看看打印的值是多少。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>value<span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">function</span> <span class="token function">foo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    echo $value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">bar</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    local value<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span>
    foo<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
bar
</code></pre></div><p><strong>思考题：</strong> 下面两段代码的执行结果是多少？</p> <p>代码1：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;global scope&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;local scope&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> scope<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>代码2：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;global scope&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;local scope&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> scope<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> f<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>两段代码都会打印：<code>local scope</code>。</p> <p>因为JavaScript采用的是词法作用域，函数的作用域基于函数创建的位置。</p> <p>JavaScript 函数的执行用到了作用域链，这个作用域链是在函数定义的时候创建的。嵌套的函数 f() 定义在这个作用域链里，其中的变量 scope 一定是局部变量，不管何时何地执行函数 f()，这种绑定在执行 f() 时依然有效。</p> <h2 id="_3-执行上下文栈"><a href="#_3-执行上下文栈" class="header-anchor">#</a> 3. 执行上下文栈</h2> <h3 id="_3-1-顺序执行"><a href="#_3-1-顺序执行" class="header-anchor">#</a> 3.1 顺序执行</h3> <p>如果要问到 JavaScript 代码执行顺序的话，想必写过 JavaScript 的开发者都会有个直观的印象，那就是顺序执行，看下面这段代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// foo1</span>

<span class="token keyword">var</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo2</span>
</code></pre></div><p>打印的结果为：</p> <div class="language- extra-class"><pre class="language-text"><code>foo1
foo2
</code></pre></div><p>然而去看这段代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// foo2</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// foo2</span>
</code></pre></div><p>打印的结果却是两个 <code>foo2</code>。</p> <p>这是因为 JavaScript 引擎并非一行一行地分析和执行程序，而是一段一段地分析执行。当执行一段代码的时候，会进行一个“准备工作”，比如第一个例子中的 <strong>变量提升</strong> ，和第二个例子中的 <strong>函数提升</strong> 。</p> <p>但是本文真正想让大家思考的是：这个“一段一段”中的“段”究竟是怎么划分的呢？</p> <p>到底JavaScript引擎遇到一段怎样的代码时才会做“准备工作”呢？</p> <h3 id="_3-2-可执行代码"><a href="#_3-2-可执行代码" class="header-anchor">#</a> 3.2 可执行代码</h3> <p>这就要说到 JavaScript 的可执行代码(executable code)的类型有哪些了？</p> <p>就三种，<code>全局代码、函数代码、eval代码</code> 。</p> <p>举个例子，当执行到一个函数的时候，就会进行准备工作，这里的“准备工作”，让我们用个更专业一点的说法，就叫做&quot;执行上下文(execution context)&quot;。</p> <h3 id="_3-3-执行上下文栈"><a href="#_3-3-执行上下文栈" class="header-anchor">#</a> 3.3 执行上下文栈</h3> <p>JavaScript 引擎创建了执行上下文栈（Execution context stack，ECS）来管理执行上下文</p> <p>为了模拟执行上下文栈的行为，让我们定义执行上下文栈是一个数组：</p> <div class="language-js extra-class"><pre class="language-js"><code>ECStack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>试想当 JavaScript 开始要解释执行代码的时候，最先遇到的就是全局代码，所以初始化的时候首先就会向执行上下文栈压入一个全局执行上下文，我们用 globalContext 表示它，并且只有当整个应用程序结束的时候，ECStack 才会被清空，所以程序结束之前， ECStack 最底部永远有个 globalContext：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ECStack <span class="token operator">=</span> <span class="token punctuation">[</span>
    globalContext
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>现在 JavaScript 遇到下面的这段代码了：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">fun3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'fun3'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">fun2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fun3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fun2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当<strong>执行</strong>一个函数的时候，就会创建一个执行上下文，并且压入执行上下文栈，当函数执行完毕的时候，就会将函数的执行上下文从栈中弹出。知道了这样的工作原理，让我们来看看如何处理上面这段代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 伪代码</span>

<span class="token comment">// fun1()</span>
ECStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>fun1<span class="token operator">&gt;</span> functionContext<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// fun1中竟然调用了fun2，还要创建fun2的执行上下文</span>
ECStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>fun2<span class="token operator">&gt;</span> functionContext<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 擦，fun2还调用了fun3！</span>
ECStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>fun3<span class="token operator">&gt;</span> functionContext<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// fun3执行完毕</span>
ECStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// fun2执行完毕</span>
ECStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// fun1执行完毕</span>
ECStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// javascript接着执行下面的代码，但是ECStack底层永远有个globalContext</span>
</code></pre></div><p>接下来看看 [2.4 动态作用域](#2.4 动态作用域) 中的执行顺序：</p> <p>代码1：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;global scope&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;local scope&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> scope<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>代码2：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;global scope&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;local scope&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> scope<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> f<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>两段代码执行的结果一样，但是两段代码究竟有哪些不同呢？</p> <p>答案就是执行上下文栈的变化不一样。</p> <p>让我们模拟第一段代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ECStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>checkscope<span class="token operator">&gt;</span> functionContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
ECStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>f<span class="token operator">&gt;</span> functionContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
ECStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ECStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>让我们模拟第二段代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ECStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>checkscope<span class="token operator">&gt;</span> functionContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
ECStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ECStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>f<span class="token operator">&gt;</span> functionContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
ECStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_4-变量对象"><a href="#_4-变量对象" class="header-anchor">#</a> 4. 变量对象</h2> <p>当 JavaScript 代码执行一段可执行代码(executable code)时，会创建对应的执行上下文(execution context)。</p> <p>对于每个执行上下文，都有三个重要属性：</p> <ul><li>变量对象(Variable object，VO)</li> <li>作用域链(Scope chain)</li> <li>this</li></ul> <h3 id="_4-1-变量对象"><a href="#_4-1-变量对象" class="header-anchor">#</a> 4.1 变量对象</h3> <p>变量对象是与执行上下文相关的数据作用域，存储了在上下文中定义的变量和函数声明。</p> <p>因为不同执行上下文下的变量对象稍有不同，所以我们来聊聊全局上下文下的变量对象和函数上下文下的变量对象。</p> <h3 id="_4-2-全局上下文"><a href="#_4-2-全局上下文" class="header-anchor">#</a> 4.2 全局上下文</h3> <p>我们先了解一个概念，叫全局对象。在 <a href="http://www.w3school.com.cn/jsref/jsref_obj_global.asp" target="_blank" rel="noopener noreferrer">W3School<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中也有介绍：</p> <ul><li>全局对象是预定义的对象，作为 JavaScript 的全局函数和全局属性的占位符。通过使用全局对象，可以访问所有其他所有预定义的对象、函数和属性。</li> <li>在顶层 JavaScript 代码中，可以用关键字 this 引用全局对象。因为全局对象是作用域链的头，这意味着所有非限定性的变量和函数名都会作为该对象的属性来查询。</li> <li>例如，当JavaScript 代码引用 parseInt() 函数时，它引用的是全局对象的 parseInt 属性。全局对象是作用域链的头，还意味着在顶层 JavaScript 代码中声明的所有变量都将成为全局对象的属性。</li></ul> <ol><li>可以通过 this 引用，在客户端 JavaScript 中，全局对象就是 Window 对象。</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>全局对象是由 Object 构造函数实例化的一个对象。</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>预定义了一堆，嗯，一大堆函数和属性。</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 都能生效</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>作为全局变量的宿主。</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="5"><li>客户端 JavaScript 中，全局对象有 window 属性指向自身。</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>window<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>其实就是： <strong>全局上下文中的变量对象就是全局对象！</strong></p> <h3 id="_4-3-函数上下文"><a href="#_4-3-函数上下文" class="header-anchor">#</a> 4.3 函数上下文</h3> <p>在函数上下文中，我们用活动对象(activation object, AO)来表示变量对象。</p> <p>活动对象和变量对象其实是一个东西，只是变量对象是规范上的或者说是引擎实现上的，不可在 JavaScript 环境中访问，只有到当进入一个执行上下文中，这个执行上下文的变量对象才会被激活，所以才叫 activation object 呐，而只有被激活的变量对象，也就是活动对象上的各种属性才能被访问。</p> <p>活动对象是在进入函数上下文时刻被创建的，它通过函数的 arguments 属性初始化。arguments 属性值是 Arguments 对象。</p> <h3 id="_4-4-执行过程"><a href="#_4-4-执行过程" class="header-anchor">#</a> 4.4 执行过程</h3> <p>执行上下文的代码会分成两个阶段进行处理：分析和执行。</p> <ul><li>进入执行上下文</li></ul> <p>当进入执行上下文时，这时候还没有执行代码，</p> <p>变量对象会包括：</p> <ol><li>函数的所有形参 (如果是函数上下文)
<ul><li>由名称和对应值组成的一个变量对象的属性被创建</li> <li>没有实参，属性值设为 undefined</li></ul></li> <li>函数声明
<ul><li>由名称和对应值（函数对象(function-object)）组成一个变量对象的属性被创建</li> <li>如果变量对象已经存在相同名称的属性，则完全替换这个属性</li></ul></li> <li>变量声明
<ul><li>由名称和对应值（undefined）组成一个变量对象的属性被创建；</li> <li>如果变量名称跟已经声明的形式参数或函数相同，则变量声明不会干扰已经存在的这类属性</li></ul></li></ol> <p>举个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">var</span> <span class="token function-variable function">d</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

  b <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在进入执行上下文后，这时候的 AO 是：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token constant">AO</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">arguments</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token number">0</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    <span class="token literal-property property">c</span><span class="token operator">:</span> reference to <span class="token keyword">function</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">d</span><span class="token operator">:</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>代码执行</li></ul> <p>在代码执行阶段，会顺序执行代码，根据代码，修改变量对象的值</p> <p>还是上面的例子，当代码执行完后，这时候的 AO 是：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token constant">AO</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">arguments</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token number">0</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
    <span class="token literal-property property">c</span><span class="token operator">:</span> reference to <span class="token keyword">function</span> <span class="token function">c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">d</span><span class="token operator">:</span> reference to FunctionExpression <span class="token string">&quot;d&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>到这里变量对象的创建过程就介绍完了，让我们简洁的总结我们上述所说：</p> <ol><li>全局上下文的变量对象初始化是全局对象</li> <li>函数上下文的变量对象初始化只包括 Arguments 对象</li> <li>在进入执行上下文时会给变量对象添加形参、函数声明、变量声明等初始的属性值</li> <li>在代码执行阶段，会再次修改变量对象的属性值</li></ol> <p><strong>思考题1：</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ???</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ???</span>
</code></pre></div><p>第一段会报错：<code>Uncaught ReferenceError: a is not defined</code>。</p> <p>第二段会打印：<code>1</code>。</p> <p>这是因为函数中的 &quot;a&quot; 并没有通过 var 关键字声明，所有不会被存放在 AO 中。</p> <p>第一段执行 console 的时候， AO 的值是：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token constant">AO</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">arguments</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>没有 a 的值，然后就会到全局去找，全局也没有，所以会报错。</p> <p>当第二段执行 console 的时候，全局对象已经被赋予了 a 属性，这时候就可以从全局找到 a 的值，所以会打印 1。</p> <p><strong>思考题2：</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><p>打印函数：[Function: foo]，而不是 undefined 。</p> <p>这是因为在进入执行上下文时，首先会处理函数声明，其次会处理变量声明，如果变量名称跟已经声明的形式参数或函数相同，则变量声明不会干扰已经存在的这类属性。</p> <h2 id="_5-作用域链"><a href="#_5-作用域链" class="header-anchor">#</a> 5. 作用域链</h2> <p>我们已经知道：当JavaScript代码执行一段可执行代码(executable code)时，会创建对应的执行上下文(execution context)。</p> <p>对于每个执行上下文，都有三个重要属性：</p> <ul><li>变量对象(Variable object，VO)</li> <li>作用域链(Scope chain)</li> <li>this</li></ul> <h3 id="_5-1-作用域链"><a href="#_5-1-作用域链" class="header-anchor">#</a> 5.1 作用域链</h3> <p>当查找变量的时候，会先从当前上下文的变量对象中查找，如果没有找到，就会从父级(词法层面上的父级)执行上下文的变量对象中查找，一直找到全局上下文的变量对象，也就是全局对象。这样由多个执行上下文的变量对象构成的链表就叫做作用域链。</p> <p>下面，让我们以一个函数的创建和激活两个时期来讲解作用域链是如何创建和变化的。</p> <h3 id="_5-2-函数创建"><a href="#_5-2-函数创建" class="header-anchor">#</a> 5.2 函数创建</h3> <p>在讲解词法作用域和动态作用域时，我们知道： <strong>函数的作用域在函数定义的时候就决定了。</strong></p> <p>这是因为函数有一个内部属性 [[scope]]，当函数创建的时候，就会保存所有父变量对象到其中，你可以理解 [[scope]] 就是所有父变量对象的层级链，但是注意：[[scope]] 并不代表完整的作用域链！</p> <p>举个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>函数创建时，各自的[[scope]]为：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
foo<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">[</span>scope<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  globalContext<span class="token punctuation">.</span><span class="token constant">VO</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

bar<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">[</span>scope<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    fooContext<span class="token punctuation">.</span><span class="token constant">AO</span><span class="token punctuation">,</span>
    globalContext<span class="token punctuation">.</span><span class="token constant">VO</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="_5-3-函数激活"><a href="#_5-3-函数激活" class="header-anchor">#</a> 5.3 函数激活</h3> <p>当函数激活时，进入函数上下文，创建 VO/AO 后，就会将活动对象添加到作用链的前端。</p> <p>这时候执行上下文的作用域链，我们命名为 Scope：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>Scope <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token constant">AO</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>Scope<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>至此，作用域链创建完毕。</p> <h3 id="_5-4-总结"><a href="#_5-4-总结" class="header-anchor">#</a> 5.4 总结</h3> <p>以下面的例子为例，结合着之前讲的变量对象和执行上下文栈，我们来总结一下函数执行上下文中作用域链和变量对象的创建过程：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;global scope&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> scope2 <span class="token operator">=</span> <span class="token string">'local scope'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> scope2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>执行过程如下：</p> <ol><li>checkscope 函数被创建，保存作用域链到 内部属性[[scope]]</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>checkscope<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">[</span>scope<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    globalContext<span class="token punctuation">.</span><span class="token constant">VO</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>执行 checkscope 函数，创建 checkscope 函数执行上下文，checkscope 函数执行上下文被压入执行上下文栈</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ECStack <span class="token operator">=</span> <span class="token punctuation">[</span>
    checkscopeContext<span class="token punctuation">,</span>
    globalContext
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>checkscope 函数并不立刻执行，开始做准备工作，第一步：复制函数[[scope]]属性创建作用域链</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>checkscopeContext <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">Scope</span><span class="token operator">:</span> checkscope<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">[</span>scope<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li>第二步：用 arguments 创建活动对象，随后初始化活动对象，加入形参、函数声明、变量声明</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>checkscopeContext <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token constant">AO</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">arguments</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">scope2</span><span class="token operator">:</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">}</span>，
    <span class="token literal-property property">Scope</span><span class="token operator">:</span> checkscope<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">[</span>scope<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="5"><li>第三步：将活动对象压入 checkscope 作用域链顶端</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>checkscopeContext <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token constant">AO</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">arguments</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">scope2</span><span class="token operator">:</span> <span class="token keyword">undefined</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">Scope</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">AO</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>Scope<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="6"><li>准备工作做完，开始执行函数，随着函数的执行，修改 AO 的属性值</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>checkscopeContext <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token constant">AO</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">arguments</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">0</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">scope2</span><span class="token operator">:</span> <span class="token string">'local scope'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">Scope</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">AO</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>Scope<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="7"><li>查找到 scope2 的值，返回后函数执行完毕，函数上下文从执行上下文栈中弹出</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ECStack <span class="token operator">=</span> <span class="token punctuation">[</span>
    globalContext
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_6-从ecmascript规范解读this"><a href="#_6-从ecmascript规范解读this" class="header-anchor">#</a> 6. 从ECMAScript规范解读this</h2> <p>参考原文： <a href="https://github.com/mqyqingfeng/Blog/issues/7" target="_blank" rel="noopener noreferrer">JavaScript深入之从ECMAScript规范解读this<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>this一般有几种调用场景：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token function-variable function">b</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>作为对象调用时，指向该对象 obj.b();  // 指向obj</li> <li>作为函数调用, var b = obj.b;  b();   // 指向全局window</li> <li>作为构造函数调用 var b = new Fun();  // this指向当前实例对象</li> <li>作为call与apply调用 obj.b.apply(object, []);  // this指向当前的object</li></ul> <p><strong>附加补充： Reference Type</strong></p> <p>一个动态执行的方法调用可能会丢失 <code>this</code>。</p> <p>例如：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
  <span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">bye</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;Bye&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

user<span class="token punctuation">.</span><span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 正常运行</span>

<span class="token comment">// 现在让我们基于 name 来选择调用 user.hi 或 user.bye</span>
<span class="token punctuation">(</span>user<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">&quot;John&quot;</span> <span class="token operator">?</span> user<span class="token punctuation">.</span>hi <span class="token operator">:</span> user<span class="token punctuation">.</span>bye<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error!</span>
</code></pre></div><p>在最后一行有个在 <code>user.hi</code> 和 <code>user.bye</code> 中做选择的条件（三元）运算符。当前情形下的结果是 <code>user.hi</code>。</p> <p>接着该方法被通过 <code>()</code> 立刻调用。但是并不能正常工作！</p> <p>如你所见，此处调用导致了一个错误，因为在该调用中 <code>&quot;this&quot;</code> 的值变成了 <code>undefined</code>。</p> <p>这样是能工作的（对象.方法）：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>user<span class="token punctuation">.</span><span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这就无法工作了（被评估的方法）：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">&quot;John&quot;</span> <span class="token operator">?</span> user<span class="token punctuation">.</span>hi <span class="token operator">:</span> user<span class="token punctuation">.</span>bye<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Error!</span>
</code></pre></div><p>为什么呢？欲知缘何，且让我们深入 <code>obj.method()</code> 调用运行的本质。</p> <h3 id="_6-1-reference-type-解读"><a href="#_6-1-reference-type-解读" class="header-anchor">#</a> 6.1 Reference type 解读</h3> <p>仔细看的话，我们可能注意到 <code>obj.method()</code> 语句中的两个操作：</p> <ol><li>首先，点 <code>'.'</code> 取了属性 <code>obj.method</code> 的值。</li> <li>接着 <code>()</code> 执行了它。</li></ol> <p>那么，<code>this</code> 的信息是怎么从第一部分传递到第二部分的呢？</p> <p>如果我们将这些操作放在不同的行，<code>this</code> 必定是会丢失的：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
  <span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 把获取方法和调用方法拆成两行</span>
<span class="token keyword">let</span> hi <span class="token operator">=</span> user<span class="token punctuation">.</span>hi<span class="token punctuation">;</span>
<span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 报错了，因为 this 的值是 undefined</span>
</code></pre></div><p>这里 <code>hi = user.hi</code> 把函数赋值给了一个变量，接下来在最后一行它是完全独立的，所以这里没有 <code>this</code>。</p> <p><strong>为确保 <code>user.hi()</code> 调用正常运行，JavaScript 玩了个小把戏 —— 点 <code>'.'</code> 返回的不是一个函数，而是一个特殊的 <a href="https://tc39.github.io/ecma262/#sec-reference-specification-type" target="_blank" rel="noopener noreferrer">Reference Type<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的值。</strong></p> <p>Reference Type 是 ECMA 中的一个“规范类型”。我们不能直接使用它，但它被用在 JavaScript 语言内部。</p> <p>Reference Type 的值是一个三个值的组合 <code>(base, name, strict)</code>，其中：</p> <ul><li><code>base</code> 是对象。</li> <li><code>name</code> 是属性名。</li> <li><code>strict</code> 在 <code>use strict</code> 模式下为 true。</li></ul> <p>对属性 <code>user.hi</code> 访问的结果不是一个函数，而是一个 Reference Type 的值。对于 <code>user.hi</code>，在严格模式下是：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Reference Type 的值</span>
<span class="token punctuation">(</span>user<span class="token punctuation">,</span> <span class="token string">&quot;hi&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre></div><p>当 <code>()</code> 被在 Reference Type 上调用时，它们会接收到关于对象和对象的方法的完整信息，然后可以设置正确的 <code>this</code>（在此处 <code>=user</code>）。</p> <p>Reference Type 是一个特殊的“中间人”内部类型，目的是从 <code>.</code> 传递信息给 <code>()</code> 调用。</p> <p>任何例如赋值 <code>hi = user.hi</code> 等其他的操作，都会将 Reference Type 作为一个整体丢弃掉，而会取 <code>user.hi</code>（一个函数）的值并继续传递。所以任何后续操作都“丢失”了 <code>this</code>。</p> <p>因此，<code>this</code> 的值仅在函数直接被通过点符号 <code>obj.method()</code> 或方括号 <code>obj['method']()</code> 语法（此处它们作用相同）调用时才被正确传递。还有很多种解决这个问题的方式，例如 <a href="https://zh.javascript.info/bind#solution-2-bind" target="_blank" rel="noopener noreferrer">func.bind()<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="_6-2-总结"><a href="#_6-2-总结" class="header-anchor">#</a> 6.2 总结</h3> <p>Reference Type 是语言内部的一个类型。</p> <p>读取一个属性，例如在 <code>obj.method()</code> 中，<code>.</code> 返回的准确来说不是属性的值，而是一个特殊的 “Reference Type” 值，其中储存着属性的值和它的来源对象。</p> <p>这是为了随后的方法调用 <code>()</code> 获取来源对象，然后将 <code>this</code> 设为它。</p> <p>对于所有其它操作，Reference Type 会自动变成属性的值（在我们这个情况下是一个函数）。</p> <p>这整个机制对我们是不可见的。它仅在一些微妙的情况下才重要，例如使用表达式从对象动态地获取一个方法时。</p> <p>下面来看两个实例：</p> <ul><li><strong>实例1：</strong> 检查语法</li></ul> <p>这段代码的结果是什么？</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">go</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">(</span>user<span class="token punctuation">.</span>go<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>错误</strong>! <code>user is not defined</code></p> <p>大多数浏览器中的错误信息并不能说明是什么出现了问题。</p> <p><strong>出现此错误是因为在 <code>user = {...}</code> 后面漏了一个分号。</strong></p> <p>JavaScript 不会在括号 <code>(user.go)()</code> 前自动插入分号，所以解析的代码如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">go</span><span class="token operator">:</span><span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>go<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>然后我们还可以看到，这样的联合表达式在语法上是将对象 <code>{ go: ... }</code> 作为参数为 <code>(user.go)</code> 的函数。这发生在 <code>let user</code> 的同一行上，因此 <code>user</code> 对象是甚至还没有被定义，因此出现了错误。</p> <p>如果我们插入该分号，一切都变得正常：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> user <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
  <span class="token function-variable function">go</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span>user<span class="token punctuation">.</span>go<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// John</span>
</code></pre></div><p>要注意的是，<code>(user.go)</code> 外边这层括号在这没有任何作用。通常用它们来设置操作的顺序，但在这里点符号 <code>.</code> 总是会先执行，所以并没有什么影响。分号是唯一重要的。</p> <p><strong>实例2：</strong> 解释 &quot;this&quot; 的值</p> <p>在下面的代码中，我们试图连续调用 <code>obj.go()</code> 方法 4 次。</p> <p>但是前两次和后两次调用的结果不同，为什么呢？</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> obj<span class="token punctuation">,</span> method<span class="token punctuation">;</span>

obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">go</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

obj<span class="token punctuation">.</span><span class="token function">go</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// (1) [object Object]</span>

<span class="token punctuation">(</span>obj<span class="token punctuation">.</span>go<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment">// (2) [object Object]</span>

<span class="token punctuation">(</span>method <span class="token operator">=</span> obj<span class="token punctuation">.</span>go<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// (3) undefined</span>

<span class="token punctuation">(</span>obj<span class="token punctuation">.</span>go <span class="token operator">||</span> obj<span class="token punctuation">.</span>stop<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (4) undefined</span>
</code></pre></div><p>这里是解析。</p> <ol><li><p>它是一个常规的方法调用。</p></li> <li><p>同样，括号没有改变执行的顺序，点符号总是先执行。</p></li> <li><p>这里我们有一个更复杂的 <code>(expression)()</code> 调用。这个调用就像被分成了两行（代码）一样：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>f <span class="token operator">=</span> obj<span class="token punctuation">.</span>go<span class="token punctuation">;</span> <span class="token comment">// 计算函数表达式</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// 调用</span>
</code></pre></div><p>这里的 <code>f()</code> 是作为一个没有（设定）<code>this</code> 的函数执行的。</p></li> <li><p>与 <code>(3)</code> 相类似，在括号 <code>()</code> 的左边也有一个表达式。</p></li></ol> <p>要解释 <code>(3)</code> 和 <code>(4)</code> 得到这种结果的原因，我们需要回顾一下属性访问器（点符号或方括号）返回的是引用类型的值。</p> <p>除了方法调用之外的任何操作（如赋值 <code>=</code> 或 <code>||</code>），都会把它转换为一个不包含允许设置 <code>this</code> 信息的普通值。</p> <h2 id="_7-执行上下文"><a href="#_7-执行上下文" class="header-anchor">#</a> 7. 执行上下文</h2> <p>在《执行上下文栈》中讲到，当 JavaScript 代码执行一段可执行代码(executable code)时，会创建对应的执行上下文(execution context)。</p> <p>对于每个执行上下文，都有三个重要属性：</p> <ul><li>变量对象(Variable object，VO)</li> <li>作用域链(Scope chain)</li> <li>this</li></ul> <p>看 《2.4 动态作用域》中，提出这样一道思考题：</p> <p>代码1：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;global scope&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;local scope&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> scope<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>代码2：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;global scope&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;local scope&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> scope<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> f<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>两段代码都会打印'local scope'。虽然两段代码执行的结果一样，但是两段代码究竟有哪些不同呢？</p> <p>紧接着就在《执行上下文栈》中，讲到了两者的区别在于执行上下文栈的变化不一样，然而，如果是这样笼统的回答，依然显得不够详细，本篇就会详细的解析执行上下文栈和执行上下文的具体变化过程。</p> <h3 id="_7-1-具体执行分析"><a href="#_7-1-具体执行分析" class="header-anchor">#</a> 7.1 具体执行分析</h3> <p>我们分析第一段代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;global scope&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;local scope&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> scope<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>执行过程如下：</p> <ol><li>执行全局代码，创建全局执行上下文，全局上下文被压入执行上下文栈</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ECStack <span class="token operator">=</span> <span class="token punctuation">[</span>
    globalContext
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>2.全局上下文初始化</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>globalContext <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">VO</span><span class="token operator">:</span> <span class="token punctuation">[</span>global<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">Scope</span><span class="token operator">:</span> <span class="token punctuation">[</span>globalContext<span class="token punctuation">.</span><span class="token constant">VO</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token keyword">this</span><span class="token operator">:</span> globalContext<span class="token punctuation">.</span><span class="token constant">VO</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>初始化的同时，checkscope 函数被创建，保存作用域链到函数的内部属性[[scope]]</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>checkscope<span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token punctuation">[</span>scope<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  globalContext<span class="token punctuation">.</span><span class="token constant">VO</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li>执行 checkscope 函数，创建 checkscope 函数执行上下文，checkscope 函数执行上下文被压入执行上下文栈</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ECStack <span class="token operator">=</span> <span class="token punctuation">[</span>
  checkscopeContext<span class="token punctuation">,</span>
  globalContext
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><ol start="4"><li>checkscope 函数执行上下文初始化：
<ol><li>复制函数 [[scope]] 属性创建作用域链，</li> <li>用 arguments 创建活动对象，</li> <li>初始化活动对象，即加入形参、函数声明、变量声明，</li> <li>将活动对象压入 checkscope 作用域链顶端。</li></ol></li></ol> <p>同时 f 函数被创建，保存作用域链到 f 函数的内部属性[[scope]]</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>checkscopeContext <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">AO</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">arguments</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">scope</span><span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span>
    <span class="token literal-property property">f</span><span class="token operator">:</span> reference to <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">Scope</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">AO</span><span class="token punctuation">,</span> globalContext<span class="token punctuation">.</span><span class="token constant">VO</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token keyword">this</span><span class="token operator">:</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="5"><li>执行 f 函数，创建 f 函数执行上下文，f 函数执行上下文被压入执行上下文栈</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ECStack <span class="token operator">=</span> <span class="token punctuation">[</span>
  fContext<span class="token punctuation">,</span>
  checkscopeContext<span class="token punctuation">,</span>
  globalContext
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><ol start="6"><li>f函数执行上下文初始化, 以下跟第 4 步相同：
<ol><li>复制函数 [[scope]] 属性创建作用域链</li> <li>用 arguments 创建活动对象</li> <li>初始化活动对象，即加入形参、函数声明、变量声明</li> <li>将活动对象压入 f 作用域链顶端</li></ol></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fContext <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token constant">AO</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">arguments</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">Scope</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">AO</span><span class="token punctuation">,</span> checkscopeContext<span class="token punctuation">.</span><span class="token constant">AO</span><span class="token punctuation">,</span> globalContext<span class="token punctuation">.</span><span class="token constant">VO</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token keyword">this</span><span class="token operator">:</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="7"><li><p>函数执行，沿着作用域链查找 scope 值，返回 scope 值</p></li> <li><p>f函数执行完毕，f 函数上下文从执行上下文栈中弹出</p></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ECStack <span class="token operator">=</span> <span class="token punctuation">[</span>
  checkscopeContext<span class="token punctuation">,</span>
  globalContext
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><ol start="9"><li>checkscope 函数执行完毕，checkscope 执行上下文从执行上下文栈中弹出</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ECStack <span class="token operator">=</span> <span class="token punctuation">[</span>
  globalContext
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_8-闭包"><a href="#_8-闭包" class="header-anchor">#</a> 8. 闭包</h2> <h3 id="_8-1-定义"><a href="#_8-1-定义" class="header-anchor">#</a> 8.1 定义</h3> <p>MDN 对闭包的定义为：</p> <p>一个函数和对其周围状态（<strong>lexical environment，词法环境</strong>）的引用捆绑在一起（或者说函数被引用包围），这样的组合就是<strong>闭包</strong>（<strong>closure</strong>）。也就是说，闭包让你可以在一个内层函数中访问到其外层函数的作用域。在 JavaScript 中，每当创建一个函数，闭包就会在函数创建的同时被创建出来。</p> <p>大白话简单理解闭包:  <strong>能够访问其他函数内部变量的函数，被称为闭包。</strong></p> <p><strong>闭包是指那些能够访问自由变量的函数。</strong></p> <p>那什么是自由变量呢？</p> <p><strong>自由变量是指在函数中使用的，但既不是函数参数也不是函数的局部变量的变量。</strong></p> <p>由此，我们可以看出闭包共有两部分组成：</p> <p><strong>闭包 = 函数 + 函数能够访问的自由变量</strong></p> <p>举个例子：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>foo 函数可以访问变量 a，但是 a 既不是 foo 函数的局部变量，也不是 foo 函数的参数，所以 a 就是自由变量。</p> <p>那么，函数 foo + foo 函数访问的自由变量 a 不就是构成了一个闭包嘛……</p> <p>还真是这样的！</p> <p>所以在《JavaScript权威指南》中就讲到：从技术的角度讲，所有的JavaScript函数都是闭包。</p> <p>咦，这怎么跟我们平时看到的讲到的闭包不一样呢！？</p> <p>别着急，这是理论上的闭包，其实还有一个实践角度上的闭包，让我们看看汤姆大叔翻译的关于闭包的文章中的定义：</p> <p>ECMAScript中，闭包指的是：</p> <ol><li>从理论角度：所有的函数。因为它们都在创建的时候就将上层上下文的数据保存起来了。哪怕是简单的全局变量也是如此，因为函数中访问全局变量就相当于是在访问自由变量，这个时候使用最外层的作用域。</li> <li>从实践角度：以下函数才算是闭包：
<ol><li>即使创建它的上下文已经销毁，它仍然存在（比如，内部函数从父函数中返回）</li> <li>在代码中引用了自由变量</li></ol></li></ol> <p>接下来就来讲讲实践上的闭包。</p> <h3 id="_8-2分析"><a href="#_8-2分析" class="header-anchor">#</a> 8.2分析</h3> <p>让我们先写个例子，例子依然是来自《JavaScript权威指南》，稍微做点改动：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;global scope&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> scope <span class="token operator">=</span> <span class="token string">&quot;local scope&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> scope<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> f<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token function">checkscope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>首先我们要分析一下这段代码中执行上下文栈和执行上下文的变化情况。这里直接给出简要的执行过程：</p> <ol><li>进入全局代码，创建全局执行上下文，全局执行上下文压入执行上下文栈</li> <li>全局执行上下文初始化</li> <li>执行 checkscope 函数，创建 checkscope 函数执行上下文，checkscope 执行上下文被压入执行上下文栈</li> <li>checkscope 执行上下文初始化，创建变量对象、作用域链、this等</li> <li>checkscope 函数执行完毕，checkscope 执行上下文从执行上下文栈中弹出</li> <li>执行 f 函数，创建 f 函数执行上下文，f 执行上下文被压入执行上下文栈</li> <li>f 执行上下文初始化，创建变量对象、作用域链、this等</li> <li>f 函数执行完毕，f 函数上下文从执行上下文栈中弹出</li></ol> <p>了解到这个过程，我们应该思考一个问题，那就是：</p> <p>当 f 函数执行的时候，checkscope 函数上下文已经被销毁了啊(即从执行上下文栈中被弹出)，怎么还会读取到 checkscope 作用域下的 scope 值呢？</p> <p>以上的代码，要是转换成 PHP，就会报错，因为在 PHP 中，f 函数只能读取到自己作用域和全局作用域里的值，所以读不到 checkscope 下的 scope 值。(这段我问的PHP同事……)</p> <p>然而 JavaScript 却是可以的！</p> <p>当我们了解了具体的执行过程后，我们知道 f 执行上下文维护了一个作用域链：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>fContext <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">Scope</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">AO</span><span class="token punctuation">,</span> checkscopeContext<span class="token punctuation">.</span><span class="token constant">AO</span><span class="token punctuation">,</span> globalContext<span class="token punctuation">.</span><span class="token constant">VO</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>对的，就是因为这个作用域链，f 函数依然可以读取到 checkscopeContext.AO 的值，说明当 f 函数引用了 checkscopeContext.AO 中的值的时候，即使 checkscopeContext 被销毁了，但是 JavaScript 依然会让 checkscopeContext.AO 活在内存中，f 函数依然可以通过 f 函数的作用域链找到它，正是因为 JavaScript 做到了这一点，从而实现了闭包这个概念。</p> <p>所以，让我们再看一遍实践角度上闭包的定义：</p> <ol><li>即使创建它的上下文已经销毁，它仍然存在（比如，内部函数从父函数中返回）</li> <li>在代码中引用了自由变量</li></ol> <p>在这里再补充一个《JavaScript权威指南》英文原版对闭包的定义:</p> <p>This combination of a function object and a scope (a set of variable bindings) in which the function’s variables are resolved is called a closure in the computer science literature.</p> <p>闭包在计算机科学中也只是一个普通的概念，大家不要去想得太复杂。</p> <h3 id="_8-3-必刷题"><a href="#_8-3-必刷题" class="header-anchor">#</a> 8.3 必刷题</h3> <p>接下来，看这道刷题必刷，面试必考的闭包题：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>答案是都是 3，让我们分析一下原因：</p> <p>当执行到 data[0] 函数之前，此时全局上下文的 VO 为：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>globalContext <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token constant">VO</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当执行 data[0] 函数的时候，data[0] 函数的作用域链为：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>Context <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">Scope</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">AO</span><span class="token punctuation">,</span> globalContext<span class="token punctuation">.</span><span class="token constant">VO</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>data[0]Context 的 AO 并没有 i 值，所以会从 globalContext.VO 中查找，i 为 3，所以打印的结果就是 3。</p> <p>data[1] 和 data[2] 是一样的道理。</p> <p>所以让我们改成闭包看看：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  data<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
data<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当执行到 data[0] 函数之前，此时全局上下文的 VO 为：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>globalContext <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token constant">VO</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当执行 data[0] 函数的时候，data[0] 函数的作用域链发生了改变：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>Context <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">Scope</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token constant">AO</span><span class="token punctuation">,</span> 匿名函数Context<span class="token punctuation">.</span><span class="token constant">AO</span> globalContext<span class="token punctuation">.</span><span class="token constant">VO</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>匿名函数执行上下文的AO为：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>匿名函数Context <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token constant">AO</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">arguments</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token number">0</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">i</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>data[0]Context 的 AO 并没有 i 值，所以会沿着作用域链从匿名函数 Context.AO 中查找，这时候就会找 i 为 0，找到了就不会往 globalContext.VO 中查找了，即使 globalContext.VO 也有 i 的值(值为3)，所以打印的结果就是0。</p> <p>data[1] 和 data[2] 是一样的道理。</p> <h3 id="_8-4-闭包使用场景"><a href="#_8-4-闭包使用场景" class="header-anchor">#</a> 8.4 闭包使用场景</h3> <ul><li>用闭包模拟私有方法</li></ul> <p>javascript 没有 java 中那种 public private 的访问权限控制，对象中的所用方法和属性均可以访问，这就造成了安全隐患，内部的属性任何开发者都可以随意修改。虽然语言层面不支持私有属性的创 建，但是我们可以用闭包的手段来模拟出私有属性：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">makeCounter</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> privateCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">changeBy</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    privateCounter <span class="token operator">+=</span> val<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">changeBy</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">changeBy</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> privateCounter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Counter1 <span class="token operator">=</span> <span class="token function">makeCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Counter2 <span class="token operator">=</span> <span class="token function">makeCounter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Counter1<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* logs 0 */</span>
Counter1<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Counter1<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Counter1<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* logs 2 */</span>
Counter1<span class="token punctuation">.</span><span class="token function">decrement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Counter1<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* logs 1 */</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Counter2<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* logs 0 */</span>
Counter2<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Counter2<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Counter2<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* logs 2 */</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Counter1<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* logs 1 */</span>
</code></pre></div><p>注意两个计数器 Counter1 和 Counter2 它们都保持各自的独立性。每个闭包都是引用自己作用域内的变量 privateCounter, 每次调用其中一个计数器时，通过改变这个变量的值，会改变这个闭包的词法环境。 然而在一个闭包内对变量的修改，不会影响到另外一个闭包中的变量。</p> <ul><li>在循环中给页面元素绑定事件响应函数</li></ul> <p>在循环中给页面元素绑定事件响应函数 在循环中给页面元素绑定事件响应函数是我们 js 面试中的非常基础且常见的考题。现有如下场景:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">var</span> nodes <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
      <span class="token keyword">var</span> length <span class="token operator">=</span> nodes<span class="token punctuation">.</span>length
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">alert</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这段代码运行之后无论点击哪个 div最后弹出的结果都是 5, 这是因为 div节点的 onclick 事件是被异步出发的, 当事件被触发的时候，for 循环早就结束了，这个时候变量 i的值已经是 5。 解决这个问题的方 法之一我们可以利用闭包,把每次循环的 i值都封闭起来。:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Document<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">var</span> nodes <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
      <span class="token keyword">var</span> length <span class="token operator">=</span> nodes<span class="token punctuation">.</span>length
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">alert</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>这样当在事件函数中顺着作用域链从内到外查找变量 i时，会先找到被封闭在闭包环境中的 i。所以最终我们用闭包改造后的代码每次点击按钮的时候会分别弹出 0，1，2，3，4。</p> <h3 id="_8-5-闭包存在什么问题"><a href="#_8-5-闭包存在什么问题" class="header-anchor">#</a> 8.5 闭包存在什么问题?</h3> <p>是闭包本身会造成常驻内存。来看下面一段代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">result</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> test <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>上述代码中，理论上来说， foo 函数作用域隔绝了外部环境，所有变量引用都在函数内部完成，foo 运行完成以后，内部的变量就应该被销毁，内存被回收。然而闭包导致了全局作用域始终存在一个 test 的变量在引用着 foo 内部的 result 函数，这就意味着 foo 内部定义的 result 函数引用数始终为 3，垃圾运行机制就无法把它销毁.这就是我们说的闭包本身会造成内部变量常驻内存。</p> <h2 id="_9-bind、call、apply"><a href="#_9-bind、call、apply" class="header-anchor">#</a> 9. bind、call、apply</h2> <h3 id="_9-1-区别"><a href="#_9-1-区别" class="header-anchor">#</a> 9.1 区别</h3> <p>this指向谁？ <strong>谁调用他就指向谁。</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// this 谁调用他就指向谁</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'freemen'</span>
<span class="token keyword">function</span> <span class="token function">sayAuthor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">'mkw'</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">this.name</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">sayAuthor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// 等价于 window.sayAuthor()</span>
</code></pre></div><p>输出： this.name freemen</p> <p>**传参方式不同： call 和 bind传参用逗号隔开，而apply传递是一个数组 **</p> <p><strong>call和apply是直接执行的，bind 返回值是函数</strong></p> <h3 id="_9-2-应用场景"><a href="#_9-2-应用场景" class="header-anchor">#</a> 9.2 应用场景</h3> <ul><li>判断数据类型</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> type <span class="token operator">=</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">type</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> type<span class="token punctuation">)</span>  <span class="token comment">// type [object Array]</span>
</code></pre></div><ul><li>类数组转数组</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> arrayLike <span class="token operator">=</span> <span class="token punctuation">{</span> 
  <span class="token number">0</span><span class="token operator">:</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>
  <span class="token number">1</span><span class="token operator">:</span> <span class="token string">&quot;age&quot;</span><span class="token punctuation">,</span>
  <span class="token number">2</span><span class="token operator">:</span> <span class="token string">&quot;gender&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">3</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> res <span class="token operator">=</span>  <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arrayLike<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">res</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>  <span class="token comment">// res [ 'name', 'age', 'gender' ]</span>
</code></pre></div><ul><li>apply  对给定数组求最大值/最小值</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> max <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> array<span class="token punctuation">)</span>
<span class="token keyword">const</span> min <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> array<span class="token punctuation">)</span>
<span class="token comment">// Math.max(...array)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">max</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> max<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">min</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> min<span class="token punctuation">)</span>
</code></pre></div><h2 id="_10-数组去重"><a href="#_10-数组去重" class="header-anchor">#</a> 10. 数组去重</h2> <h3 id="_10-1-普通数组去重"><a href="#_10-1-普通数组去重" class="header-anchor">#</a> 10.1 普通数组去重</h3> <p><strong>数组中push函数的返回值是：数组长度，会改变原数组。</strong></p> <ul><li>filter + indexOf</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">handleError</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'unique function params is not Array'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// filter + indexOf</span>
<span class="token keyword">function</span> <span class="token function">unique</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">handleError</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> array<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> array<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">===</span> index<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">unique</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// [ 1, 2, 3, 4, 5 ]</span>
</code></pre></div><ul><li>相邻元素排序</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">handleError</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'unique function params is not Array'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// sort + push</span>
<span class="token keyword">function</span> <span class="token function">unique</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">handleError</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
  arr <span class="token operator">=</span> array<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!==</span> arr<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> res<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">unique</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>Set 解构赋值</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">handleError</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'unique function params is not Array'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Set 解构赋值</span>
<span class="token keyword">function</span> <span class="token function">unique</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">handleError</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">unique</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>set + Array.from</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">handleError</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'unique function params is not Array'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Set + Array.from </span>
<span class="token keyword">function</span> <span class="token function">unique</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">handleError</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">unique</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_10-2-对象数组去重"><a href="#_10-2-对象数组去重" class="header-anchor">#</a> 10.2 对象数组去重</h3> <h2 id="_11-对给定数组求最大值"><a href="#_11-对给定数组求最大值" class="header-anchor">#</a> 11. 对给定数组求最大值</h2> <ul><li>Math.max()</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// const res = Math.max(...array);</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>Math<span class="token punctuation">,</span> array<span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>reduce 函数</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getMax</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> array<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> cur <span class="token operator">&gt;</span> pre <span class="token operator">?</span> cur <span class="token operator">:</span> pre<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getMax</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>sort</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">getMax</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> array<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">[</span>result<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">getMax</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_12-判断数据类型的方式有哪些"><a href="#_12-判断数据类型的方式有哪些" class="header-anchor">#</a> 12. 判断数据类型的方式有哪些？</h2> <p><img src="/assets/img/image-20220726110231351.4a1de9cd.png" alt="image-20220726110231351"></p> <p>有一点需要注意： <code>console.log(typeof(null)); // object</code></p> <h2 id="_13-如何实现函数节流"><a href="#_13-如何实现函数节流" class="header-anchor">#</a> 13. 如何实现函数节流？</h2> <p>规定在一个<strong>单位时间</strong>内，事件响应函数只能被触发一次。如果这个单位时间内触发多次函数，<strong>只有一次生效</strong>。</p> <p>如：window.onresize事件、mousemove事件</p> <ul><li>返回值是一个函数</li> <li>开启定时器</li> <li>如果定时器存在直接返回 false</li> <li>定时器内部清空定时器 并且把timer 置为null 然后执行我们的事件响应函数</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">&quot;X-UA-Compatible&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;IE=edge&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=device-width, initial-scale=1.0&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>throttle<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
      <span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> interval</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> timer<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            timer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token function">fn</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span> interval<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      window<span class="token punctuation">.</span>onresize <span class="token operator">=</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre></div><h2 id="_14-如何实现函数防抖"><a href="#_14-如何实现函数防抖" class="header-anchor">#</a> 14. 如何实现函数防抖？</h2> <p>事件被触发n秒后再执行回调，如果在这n秒内又被触发，则重新计时。</p> <p>比如电商网站中的搜索框，填写关键词搜索，每输入一个关键词后，不是一直触发Ajax请求。</p> <ul><li>返回值是函数</li> <li>固定间隔执行事件响应函数</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>X-UA-Compatible<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>IE=edge<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>debounce<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>searchElement<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">const</span> search <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#searchElement'</span><span class="token punctuation">)</span>
      <span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> interval</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
          timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> interval<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      search<span class="token punctuation">.</span>oninput <span class="token operator">=</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>search<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><h2 id="_15-如何实现数组扁平化"><a href="#_15-如何实现数组扁平化" class="header-anchor">#</a> 15. 如何实现数组扁平化？</h2> <p>数组扁平化也叫<strong>数组拍平、数组拉平、数组降维</strong>。指的是把多维数组变成一维数组。</p> <p>通常用在复杂场景下的数据处理，如：echarts做大屏数据展示。</p> <ul><li>reduce函数</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">flatten</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> array<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">pre<span class="token punctuation">,</span> cur</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> pre<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token function">flatten</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span> <span class="token operator">:</span> cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">flatten</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>ES6的flat函数</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">flatten</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> array<span class="token punctuation">.</span><span class="token function">flat</span><span class="token punctuation">(</span><span class="token number">Infinity</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">flatten</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>用while循环扩展运算符 <strong>较难理解！</strong></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">flatten</span><span class="token punctuation">(</span><span class="token parameter">array</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>array<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span>isArray<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token operator">...</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 1 array </span>
  <span class="token comment">// 2 已经被拍平</span>
  <span class="token keyword">return</span> array<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">flatten</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_16-object-defineproperty"><a href="#_16-object-defineproperty" class="header-anchor">#</a> 16. Object.defineProperty</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> value <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">===</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> a <span class="token operator">===</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> a <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'object'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这里补充一点：</p> <p>将对象转原始类型是根据什么流程运行的？</p> <p>对象转原始类型，会调用内置的<code>[ToPrimitive]</code>函数，对于该函数而言，其逻辑如下：</p> <ul><li>如果有<code>Symbol.toPrimitive()</code>方法，优先调用再返回</li> <li>调用<code>valueOf()</code>，如果转换为原始类型，则返回</li> <li>调用<code>toString()</code>，如果转换为原始类型，则返回</li> <li>如果都没有返回原始类型，会报错</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token function-variable function">valueOf</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 注意：下面只有两个等号的时候才成立。</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> a <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> a <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_17-如何实现new操作符"><a href="#_17-如何实现new操作符" class="header-anchor">#</a> 17. 如何实现new操作符？</h2> <ol><li>创建一个对象</li> <li>对象连接到构造函数原型上，并绑定this （this指新对象）</li> <li>执行构造函数代码 （为这个新对象添加属性）</li> <li>返回新对象</li></ol> <p>要实现new，无非就两点：</p> <ol><li>实例化对象</li> <li>返回值的问题：构造函数中如果有值返回，那实例化后的对象就是这个返回值。（注意返回的是对象哦）</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">TMap</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> options<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> options<span class="token punctuation">.</span>address<span class="token punctuation">;</span>
  <span class="token comment">// return {</span>
  <span class="token comment">//   name: 'TMAP', </span>
  <span class="token comment">//   address: 'SZ'</span>
  <span class="token comment">// }</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">ObjectFactory</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. 创建空对象</span>
  <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">// 2. 获取构造函数</span>
  <span class="token keyword">const</span> Constructor <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 3. 对象的 __proto__ 指向 Constructor.prototype</span>
  obj<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> <span class="token class-name">Constructor</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
  <span class="token comment">// 4. 用apply的方式把构造函数 Constructor 的this指向 obj，执行Constructor</span>
  <span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token function">Constructor</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 5. 根据ret的执行结果判断返回构造函数对象还是新创建的空对象</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> ret <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">?</span> ret <span class="token operator">:</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token function">ObjectFactory</span><span class="token punctuation">(</span>TMap<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'MAP'</span><span class="token punctuation">,</span> <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token string">'BJ'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>另一种写法：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">TMap</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> options<span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>address <span class="token operator">=</span> options<span class="token punctuation">.</span>address<span class="token punctuation">;</span>
  <span class="token comment">// return {</span>
  <span class="token comment">//   name: 'TMAP', </span>
  <span class="token comment">//   address: 'SZ'</span>
  <span class="token comment">// }</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Create</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> fn <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token string">'fn must be a function'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// // 1. 用new Object的方式创建一个对象obj</span>
  <span class="token comment">// var obj = new Object();</span>
  <span class="token comment">// // 2. 给该对象的__proto__赋值为fn.prototype</span>
  <span class="token comment">// obj.__proto__ = fn.prototype;</span>

  <span class="token comment">// 步骤1、2合并：</span>
  <span class="token comment">// 创建一个空对象，且这个空对象继承构造函数的 prototype 属性</span>
  <span class="token comment">// 即实现 obj.__proto__ === constructor.prototype</span>
  <span class="token keyword">var</span> obj <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>fn<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 3. 执行fn，并将obj作为内部this。使用 apply，改变构造函数 this 的指向到新建的对象，</span>
  <span class="token comment">// 这样 obj 就可以访问到构造函数中的属性</span>
  <span class="token keyword">var</span> res <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 4. 如果fn有返回值，则将其作为new操作返回内容，否则返回obj</span>
  <span class="token keyword">return</span> res <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token operator">?</span> res <span class="token operator">:</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> map <span class="token operator">=</span> <span class="token function">Create</span><span class="token punctuation">(</span>TMap<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'MAP'</span><span class="token punctuation">,</span> <span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token string">'BJ'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>map<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>使用 <code>Object.create</code> 将 <code>obj 的</code>proto<code>指向为构造函数的原型</code>；</li> <li>使用 <code>apply</code> 方法，将构造函数内的 <code>this</code> 指向为 <code>obj</code>；</li> <li>在 <code>create</code> 返回时，使用三目运算符决定返回结果。</li></ul> <p><strong>构造函数如果有显式返回值，且返回值为对象类型，那么构造函数返回结果不再是目标实例。</strong></p> <p>new 被调用后大致做了哪几件事情？</p> <ul><li>让实例可以访问到私有属性；</li> <li>让实例可以访问构造函数原型（<code>constructor.prototype</code>）所在原型链上的属性；</li> <li>构造函数返回的最后结果是引用数据类型。</li></ul> <h2 id="_18-如何实现bind函数"><a href="#_18-如何实现bind函数" class="header-anchor">#</a> 18. 如何实现bind函数？</h2> <p>bind函数实现原理：</p> <ol><li>bind函数改变this指向</li> <li>bind函数是<code>Function.prototype</code>上的方法</li> <li>bind函数的返回值也是函数</li> <li>bind函数调用之后，返回的函数的参数同样也接受处理</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">origin</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;freemen&quot;</span>
<span class="token punctuation">}</span>

<span class="token comment">// const func = origin.bind(obj, 2);</span>
<span class="token comment">// func(1)</span>

<span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">bindFn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1 获取源函数</span>
  <span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token comment">// 2 获取目标对象</span>
  <span class="token keyword">const</span> obj <span class="token operator">=</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 3. 获取源函数参数列表</span>
  <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token comment">// 4. 返回函数</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 5 获取返回函数的参数列表</span>
    <span class="token keyword">const</span> returnArgs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 6 执行源函数</span>
    <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> args<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>returnArgs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_19-如何实现call和apply函数"><a href="#_19-如何实现call和apply函数" class="header-anchor">#</a> 19. 如何实现call和apply函数？</h2> <p>call的实现原理：</p> <ol><li>改变this指针</li> <li>返回函数调用</li> <li><strong>参数挨个依次传递</strong></li></ol> <p>apply的实现原理：</p> <ol><li>改变this指针</li> <li>返回函数调用</li> <li><strong>数组参数传递</strong></li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;freemen&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">testFunc</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a :&gt;&gt; '</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'b :&gt;&gt; '</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'this.name :&gt;&gt; '</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// testFunc.call(obj,'a','b')</span>

<span class="token comment">// testFunc.apply(obj,['a','b'])</span>

<span class="token keyword">const</span> <span class="token function-variable function">core</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> args<span class="token punctuation">,</span> _this</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  args <span class="token operator">=</span> args <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 给context新增一个Symbol属性以免覆盖原有的属性</span>
  <span class="token keyword">const</span> key <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  context<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> _this<span class="token punctuation">;</span>
  <span class="token comment">// 通过隐式绑定的方式调用函数</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> context<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
  <span class="token comment">// 删除添加的属性</span>
  <span class="token keyword">delete</span> context<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token comment">// 返回函数调用的返回值</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">callFn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">core</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">applyFn</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">core</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

testFunc<span class="token punctuation">.</span><span class="token function">callFn</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
testFunc<span class="token punctuation">.</span><span class="token function">applyFn</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_20-如何实现instanceof"><a href="#_20-如何实现instanceof" class="header-anchor">#</a> 20. 如何实现instanceof？</h2> <p><code>instanceof</code>运算符用于检测构造函数的<code>prototype</code>属性是否出现在某个实例对象的原型链上。</p> <p>实现原理：</p> <ol><li>获取实例对象的隐式原型</li> <li>获取构造函数的 prototype 属性</li> <li>while 循环 -&gt; 在原型链上不断向上查找</li> <li>在原型链上不断向上查找 构造函数的显示原型</li> <li>直到 implicitPrototype = null 都没找到，返回 false</li> <li>构造函数的 prototype 属性出现在实例对象的原型上 返回 true</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;freemen&quot;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span>

<span class="token comment">// console.log(obj instanceof Person)</span>

<span class="token comment">// instanceof 运算符用于检测构造函数的 prototype 属性是否出现在某个实例对象的原型链上</span>
<span class="token keyword">function</span> <span class="token function">instance_of</span><span class="token punctuation">(</span><span class="token parameter">Obj<span class="token punctuation">,</span> Constructor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> implicitPrototype <span class="token operator">=</span> Obj<span class="token punctuation">.</span>__proto__<span class="token punctuation">;</span>  <span class="token comment">// 获取实例对象的隐式原型</span>
  <span class="token keyword">let</span> displayPrototype <span class="token operator">=</span> <span class="token class-name">Constructor</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span> <span class="token comment">// 获取构造函数的prototype 属性</span>
  <span class="token comment">// while 循环 -&gt; 在原型链上不断向上查找</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 直到 implicitPrototype = null 都没找到, 返回false</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>implicitPrototype <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">false</span>
      <span class="token comment">// 构造函数的 prototype 属性出现在实例对象的原型链上 返回 true</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>implicitPrototype <span class="token operator">===</span> displayPrototype<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 在原型链上不断查找 构造函数的显式原型</span>
    implicitPrototype <span class="token operator">=</span> implicitPrototype<span class="token punctuation">.</span>__proto__
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> has <span class="token operator">=</span> <span class="token function">instance_of</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> Person<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">has</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> has<span class="token punctuation">)</span>
</code></pre></div><h2 id="_21-javascript数组的方法有哪些"><a href="#_21-javascript数组的方法有哪些" class="header-anchor">#</a> 21. JavaScript数组的方法有哪些？</h2> <p><code>concat：</code>连接两个或更多的数组</p> <p><code>every：</code>对数组中每一项运行给定函数，如果该函数对每一项都是true，则返回true</p> <p><code>filter：</code>对数组中每一项运行给定函数，返回该函数会返回true的项组成的数组。</p> <p><code>forEach：</code>迭代器模式实现，对数组中每一项运行给定函数，无返回值。</p> <p><code>join：</code>对所有数组元素连接一个字符串。</p> <p><code>indexOf：</code>返回第一个与给定参数相等的数组元素的索引，没有找到则返回-1</p> <p><code>lastIndexOf：</code>返回数组中搜索到的与给定参数相等的元素的索引的最大值，注意是正索引，没有找到则返回-1。</p> <p><code>map：</code>对数组中的<strong>每一项</strong>运行给定函数，返回每次函数调用的结果组成的数组。</p> <p><code>reverse：</code>颠倒数组中元素的顺序。</p> <p><code>slice：</code>传入索引值，将数组里对应索引范围内的元素作为新数组返回，不改变原数组。</p> <p><code>splice：</code>通过删除或替换现有元素或者原地添加新的元素来修改数组，并以数组形式返回被修改的内容。<strong>此方法会改变原数组</strong>。 <code>array.splice(start[, deleteCount[, item1[, item2[, ...]]]])</code></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">454</span><span class="token punctuation">]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// [ 3, 454 ]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span> <span class="token comment">// [ 1, 2 ]  原数组已经被修改了</span>
</code></pre></div><p><code>some：</code>对数组中的每一项运行给定函数，如果任一项返回true，则返回true。</p> <p><code>sort：</code>按<strong>字母顺序</strong>对数组排序，支持传入指定排序方法的函数作为参数，<strong>会修改原数组</strong>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
array<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span> <span class="token comment">// [ 1, 12, 13, 4, 5 ]</span>

array<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a <span class="token operator">-</span> b<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span>  <span class="token comment">// [ 1, 4, 5, 12, 13 ]</span>
</code></pre></div><p><code>toString：</code>将数组作为字符返回。</p> <p><code>pop()</code> 方法从数组中删除最后一个元素，返回“被弹出”的值。</p> <p><code>shift()</code> 方法会删除首个数组元素，并把所有其他元素“位移”到更低的索引，返回被“位移出”的字符串。</p> <p><code>push()</code> 方法（在数组结尾处）向数组添加一个新的元素，<strong>返回新数组的长度</strong>。</p> <p><code>unshift()</code> 方法（在开头）向数组添加新元素，<strong>返回新数组的长度</strong>。</p> <p><code>reduce()</code> 用于使用回调函数对数组中的每个元素进行处理，并将处理进行汇总返回。</p> <p><code>find()</code> 用于找出第一个符合条件的数组成员。它的参数是一个回调函数，所有数组成员依次执行该回调函数，直到找出第一个返回值为<code>true</code>的成员，然后返回该成员。如果没有符合条件的成员，则返回<code>undefined</code>。</p> <h2 id="_22-去除数组中指定的元素"><a href="#_22-去除数组中指定的元素" class="header-anchor">#</a> 22. 去除数组中指定的元素？</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'freemen'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'vinko'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>

<span class="token keyword">function</span> <span class="token function">cutArray</span><span class="token punctuation">(</span><span class="token parameter">sourceArray<span class="token punctuation">,</span> target</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  sourceArray<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span>name <span class="token operator">===</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      sourceArray<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> sourceArray<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">cutArray</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token string">'freemen'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_23-栈"><a href="#_23-栈" class="header-anchor">#</a> 23. 栈</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 栈的实现</span>
<span class="token keyword">function</span> <span class="token function">Stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">// 添加元素的方法</span>
<span class="token class-name">Stack</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">push</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 移除栈顶的元素</span>
<span class="token class-name">Stack</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">pop</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 拿栈顶的元素</span>
<span class="token class-name">Stack</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">peek</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment">// 判断栈是否为空</span>
<span class="token class-name">Stack</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">isEmpty</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token comment">// 清除栈</span>
<span class="token class-name">Stack</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">clear</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> stack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span>
stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">)</span>
stack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">61</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stack<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
stack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stack<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stack<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
stack<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>stack<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_24-队列"><a href="#_24-队列" class="header-anchor">#</a> 24. 队列</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 队列的实现</span>
<span class="token keyword">function</span> <span class="token function">Queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>items <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//  添加元素</span>
<span class="token class-name">Queue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">enqueue</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//  删除元素</span>
<span class="token class-name">Queue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">dequeue</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 返回队列中第一个元素</span>
<span class="token class-name">Queue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">front</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 判断队列是否为空</span>
<span class="token class-name">Queue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">isEmpty</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span>length<span class="token operator">===</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 清空队列</span>
<span class="token class-name">Queue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">clear</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 获取队列的长度</span>
<span class="token class-name">Queue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">size</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 打印队列中元素</span>
<span class="token class-name">Queue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">print</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> queue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Queue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true </span>

queue<span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token string">&quot;freemen&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
queue<span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token string">&quot;vinko&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
queue<span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span><span class="token string">&quot;andy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

queue<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// freemen,vinko,andy </span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3 </span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>queue<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
queue<span class="token punctuation">.</span><span class="token function">dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
queue<span class="token punctuation">.</span><span class="token function">dequeue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
queue<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//andy</span>
</code></pre></div><h2 id="_25-let、const、var区别"><a href="#_25-let、const、var区别" class="header-anchor">#</a> 25. let、const、var区别？</h2> <ul><li>var存在变量提升，其他两个不存在。</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fullName <span class="token operator">=</span> <span class="token string">'windowname'</span>
<span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">fullName</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> fullName<span class="token punctuation">)</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> fullName <span class="token operator">=</span> <span class="token string">&quot;fname&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// fullName undefined</span>
</code></pre></div><p>fullName在函数f内存在变量提升，所以是undefined</p> <ul><li>let存在暂时性死区</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> fullName <span class="token operator">=</span> <span class="token string">'windowname'</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fullName <span class="token operator">=</span> <span class="token string">'test'</span>
  <span class="token keyword">let</span> fullName<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>上面的代码报错。在用let声明变量之前，不能给他赋值。</p> <ul><li>let存在块级作用域</li> <li>不可重复声明</li> <li>let 和 const声明的变量不会挂在在全局window对象下面</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> fullname <span class="token operator">=</span> <span class="token string">'zhansan'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>fullname<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// undefined</span>
</code></pre></div><ul><li>const声明之后，必须立马赋值，否则报错。</li> <li>const在声明时，给定初始值如果不是引用类型的数据，则不可修改。引用类型的数据不可变更类型。</li></ul> <h2 id="_26-箭头函数和普通函数的区别"><a href="#_26-箭头函数和普通函数的区别" class="header-anchor">#</a> 26. 箭头函数和普通函数的区别？</h2> <ol><li>箭头函数的this指向父级作用域的this</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code>window<span class="token punctuation">.</span>fullname <span class="token operator">=</span> <span class="token string">'lisi'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">fullname</span><span class="token operator">:</span> <span class="token string">'zhangsan'</span><span class="token punctuation">,</span>
  <span class="token function">sayname1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fullname<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">sayname2</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fullname<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">sayname3</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fullname<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

obj<span class="token punctuation">.</span><span class="token function">sayname1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// zhangsan</span>
obj<span class="token punctuation">.</span><span class="token function">sayname2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// zhangsan</span>
obj<span class="token punctuation">.</span><span class="token function">sayname3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// lisi</span>
</code></pre></div><ol start="2"><li><code>call()、apply()、bind()</code>无法改变箭头函数中this的指向</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sayname1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fullname<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">sayname2</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fullname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">fullname</span><span class="token operator">:</span> <span class="token string">'zhangsan'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token function">sayname1</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// zhangsan</span>
<span class="token function">sayname2</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// undefined</span>
</code></pre></div><ol start="3"><li>不可以被当作构造函数</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>fullname <span class="token operator">=</span> <span class="token string">'zhangsan'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Person { fullname: 'zhangsan' }</span>

<span class="token keyword">const</span> <span class="token function-variable function">Cat</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>fullname <span class="token operator">=</span> <span class="token string">'miaomiao'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// TypeError: Cat is not a constructor</span>
</code></pre></div><ol start="4"><li>不可以使用arguments对象，接受参数可用<code>...args</code>进行接收。</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sum</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// [Arguments] { '0': 1, '1': 2 }</span>

<span class="token keyword">const</span> <span class="token function-variable function">getSum</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">getSum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Uncaught ReferenceError: arguments is not defined</span>
</code></pre></div><ol start="5"><li>箭头函数不支持new.target</li></ol> <p><code>new.target</code>是用来确定对象是通过哪个构造函数来进行实例的。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'zhangsan'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">.</span>target<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// [Function: Person]</span>


<span class="token keyword">const</span> <span class="token function-variable function">Cat</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'miaomiao'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> target <span class="token operator">=</span> <span class="token keyword">new</span><span class="token punctuation">.</span>target<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Uncaught SyntaxError: new.target expression is not allowed here</span>
</code></pre></div><h2 id="_27-es6数组去重"><a href="#_27-es6数组去重" class="header-anchor">#</a> 27. ES6数组去重</h2> <p>Array.from + new Set()</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">54</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>要注意，在对象数组中，重复的对象是无法去重的。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'zhangsan'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'lisi'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> Array<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>  <span class="token comment">// [ { name: 'zhangsan', age: 18 }, { name: 'lisi', age: 20 } ]</span>
</code></pre></div><h2 id="_28-foreach、for-in、for-of的区别"><a href="#_28-foreach、for-in、for-of的区别" class="header-anchor">#</a> 28. forEach、for in、for of的区别</h2> <p>三个都是常见的循环迭代方式。</p> <ol><li>forEach是数组的方法</li></ol> <p>遍历的时候更加简洁，效率和 for 循环相同，不用关心集合下标的问题，减少了出错的概率。</p> <p>没有返回值</p> <p>不能使用 break 中断循环，不能使用 return返回到外层函数</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> array <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span>
<span class="token keyword">let</span> newArray <span class="token operator">=</span> array<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  i <span class="token operator">+=</span> <span class="token number">1</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token comment">// 2,4,5</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span> <span class="token comment">// [1,3,4]</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newArray<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
</code></pre></div><ol start="2"><li><code>for…in</code>是用于循环遍历数组或对象属性(大部分用于对象)</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 遍历对象</span>
<span class="token keyword">let</span> person <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'zhangsan'</span><span class="token punctuation">,</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token string">'北京'</span> <span class="token punctuation">}</span>
<span class="token keyword">let</span> text <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token keyword">in</span> person<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  text <span class="token operator">+=</span> person<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// zhangsan 28 北京</span>
</code></pre></div><ol start="3"><li><code>for...of</code>：ES6 借鉴 C++、Java、C# 和 Python语言，引入了<code>for…of</code>循环，作为遍历所有数据结构的统一的方法。</li></ol> <p>一个数据结构只要部署了 <code>Symbol.iterator</code> 属性，就被视为具有<code>iterator</code> 接口，就可以用 <code>for…of</code>循环遍历它的成员，可用 <code>for…of</code>遍历的成员包括：数组、 Set 和 Map 结构、类数组对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 数组</span>
<span class="token keyword">const</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'mukewang'</span><span class="token punctuation">,</span> <span class="token string">'freemen'</span><span class="token punctuation">,</span> <span class="token string">'liuxiajiang'</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> v <span class="token keyword">of</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>  <span class="token comment">// mukewang freemen liuxiajiang</span>
<span class="token punctuation">}</span>

<span class="token comment">// Set</span>
<span class="token keyword">var</span> names <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'zhangsan'</span><span class="token punctuation">,</span> <span class="token string">'freemen'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> e <span class="token keyword">of</span> names<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span>  <span class="token comment">// zhangsan freemen</span>

<span class="token comment">// 类数组对象 arguments</span>
<span class="token keyword">function</span> <span class="token function">printArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> x <span class="token keyword">of</span> arguments<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">printArgs</span><span class="token punctuation">(</span><span class="token string">'zhangsan'</span><span class="token punctuation">,</span> <span class="token string">'freemen'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="_29-es6中对象新增的方法有哪些"><a href="#_29-es6中对象新增的方法有哪些" class="header-anchor">#</a> 29. ES6中对象新增的方法有哪些？</h2> <h3 id="_29-1-object-is"><a href="#_29-1-object-is" class="header-anchor">#</a> 29.1 <code>Object.is()</code></h3> <p>Object.is() 判断两个值是否是相同的值。如果下列任何一项成立，则两个值相同：</p> <ul><li>两个值都是<code>undefined</code></li> <li>两个值都是<code>null</code></li> <li>两个值都是 <code>true</code> 或者都是 <code>false</code></li> <li>两个值是由相同个数的字符按照相同的顺序组成的字符串</li> <li>两个值指向同一个对象</li> <li>两个值都是数字并且
<ul><li>都是正零 <code>+0</code></li> <li>都是负零 <code>-0</code></li> <li>都是 <code>NaN</code></li> <li>都是除零和<code>NaN</code>外的其它同一个数字</li></ul></li></ul> <p>这种相等性判断逻辑和传统的<code>==</code>运算符所用的不同，<code>==</code>运算符会对它两边的操作数做隐式类型转换（如果它们类型不同），然后才进行相等性比较，（所以才会有类似 <code>&quot;&quot; == false</code> 为 <code>true</code> 的现象），但 <code>Object.is</code> 不会做这种类型转换。</p> <p>这与<code>===</code>运算符也不一样。<code>===</code>运算符和<code>==</code>运算符将数字值<code>-0</code>和<code>+0</code>视为相等，并认为<code>Number.NaN</code>不等于<code>NaN</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> secondObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> secondObj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// false</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">is</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">,</span> <span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">NaN</span> <span class="token operator">===</span> <span class="token number">NaN</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// false</span>
</code></pre></div><p>也就是说：<code>Object.is()</code>不仅可以对值类型进行正常处理而且对象类型的值也可以进行判断、对于特殊的值 <code>NaN</code> 也可以进行正常的处理。</p> <h3 id="_29-2-object-assin"><a href="#_29-2-object-assin" class="header-anchor">#</a> 29.2 <code>Object.assin()</code></h3> <p>合并两个对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'zhangsan'</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> secondObj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span> <span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> secondObj<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// { name: 'zhangsan', age: 18 }</span>
</code></pre></div><h3 id="_29-3-object-keys"><a href="#_29-3-object-keys" class="header-anchor">#</a> 29.3 <code>Object.keys()</code></h3> <p>目标对象的所有可遍历属性的键名</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'freemen'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// [ 'name', 'age' ]</span>
</code></pre></div><h3 id="_29-4-object-values"><a href="#_29-4-object-values" class="header-anchor">#</a> 29.4 <code>Object.values()</code></h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'freemen'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// [ 'freemen', 18 ]</span>
</code></pre></div><h3 id="_29-5-object-entries"><a href="#_29-5-object-entries" class="header-anchor">#</a> 29.5 <code>Object.entries()</code></h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'freemen'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// [ [ 'name', 'freemen' ], [ 'age', 18 ] ]</span>
</code></pre></div><h2 id="_30-class和function的区别"><a href="#_30-class和function的区别" class="header-anchor">#</a> 30. class和function的区别？</h2> <p>相同点：都可用作构造函数。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>fullname <span class="token operator">=</span> <span class="token string">'zhangsan'</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Person { fullname: 'zhangsan' }</span>

<span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>fullname <span class="token operator">=</span> <span class="token string">'miaomiao'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Cat { fullname: 'miaomiao' }</span>
</code></pre></div><p>class 不可以使用 call apply bind 的方式来改变他的执行上下文</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">sayname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fullname<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">fullname</span><span class="token operator">:</span> <span class="token string">'zhangsan'</span>
<span class="token punctuation">}</span>

<span class="token function">sayname</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// zhangsan</span>

<span class="token keyword">class</span> <span class="token class-name">Cat</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>fullname <span class="token operator">=</span> <span class="token string">'miaomiao'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">Cat</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// TypeError: Class constructor Cat cannot be invoked without 'new'</span>
</code></pre></div><h2 id="_31-promise"><a href="#_31-promise" class="header-anchor">#</a> 31. Promise</h2> <p>Promise 是异步编程的一种解决方案，比传统的解决方案——回调函数和事件——更合理和更强大。它由社区最早提出和实现，ES6 将其写进了语言标准，统一了用法，原生提供了<code>Promise</code>对象。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 3 个状态  pending  fulfilled  rejected</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">resolve - value</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">reject - value</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token comment">// resolve - value 1</span>
</code></pre></div><ol><li><p><strong>Promise.prototype.then()</strong></p> <p>可以支持链式调用</p> <p>then 接受两个参数且都是函数：第一个函数是我们promise 状态变成fullfilled 时候的回调函数、第二个函数是我们promise 状态变成rejected  时候的回调函数</p> <p>返回值也是Promise(新的)</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> fullName <span class="token operator">=</span> <span class="token string">'freemen'</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fullName <span class="token operator">===</span> <span class="token string">'freemen'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">fulfilled value</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token comment">// return Promise.resolve(2)</span>
    <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token parameter">fulfilledValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">fulfilled value</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> fulfilledValue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">rejectedValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rejectedValue</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> rejectedValue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
<span class="token comment">// fulfilled value 1</span>
<span class="token comment">// rejectedValue -1</span>
</code></pre></div></li> <li><p><strong>Promise.prototype.catch()</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Promise.prototype.catch() 捕获Promise错误</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> fullName <span class="token operator">=</span> <span class="token string">'freemen'</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fullName <span class="token operator">===</span> <span class="token string">'Vinko'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'promise error'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">value</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">error</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// error promise error</span>
</code></pre></div></li> <li><p><strong>Promise.prototype.finally()</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// Promise.prototype.finally()</span>
<span class="token comment">// 用于指定不管 Promise 对象最后状态如何，都会执行的操作</span>
<span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">loading start...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> fullName <span class="token operator">=</span> <span class="token string">'freemen'</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fullName <span class="token operator">===</span> <span class="token string">'freemen'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'promise error'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">value</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> value<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">error</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> error<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">loading end...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// loading start...</span>
<span class="token comment">// value 1</span>
<span class="token comment">// loading end...</span>
</code></pre></div></li> <li><p><strong>Promise.all()</strong></p> <p>用于将多个Promise实例包装成一个新的Promise实例</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> promiseArray <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>promiseArray<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// [ 1, 2, 3, 4, 5 ]</span>
</code></pre></div></li> <li><p><strong>Promise.race()</strong></p> <p>Promise.race 方法同样是将多个 Promise 实例，包装成一个新的 Promise 实例</p> <p>Promise.race 和 Promise.all 区别：Promise.race 继发、Promise.all  并发</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token keyword">const</span> promiseArray <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Promise<span class="token punctuation">.</span><span class="token function">race</span><span class="token punctuation">(</span>promiseArray<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 1</span>
</code></pre></div></li> <li><p><strong>Promise.resolve()</strong></p> <p>将现有对象转化成Promise 对象</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> fullName <span class="token operator">=</span> <span class="token string">'freemen'</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fullName <span class="token operator">===</span> <span class="token string">'freemen'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'promise error'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">res</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 上述代码等价于：</span>

Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">res</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p><strong>Promise.reject()</strong></p> <p>返回一个Promise实例，状态为rejected</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> fullName <span class="token operator">=</span> <span class="token string">'freemen'</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>fullName <span class="token operator">===</span> <span class="token string">'Vinko'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'promise error'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">res</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">rejected</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rejected</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> rejected<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

<span class="token comment">// 上述代码等价于：</span>

Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'promise error'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">rejected</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">rejected</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> rejected<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ol> <h2 id="_32-运算符实现原理"><a href="#_32-运算符实现原理" class="header-anchor">#</a> 32. <code>...</code>运算符实现原理</h2> <p>可前往 <a href="https://babeljs.io/repl" target="_blank" rel="noopener noreferrer">babel编译<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 查看。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> <div align="center"><a href="https://beian.miit.gov.cn/" target="_blank"> 辽ICP备2345662205号 </a></div></main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.9183dc48.js" defer></script><script src="/assets/js/127.b6e7f39a.js" defer></script><script src="/assets/js/3.e72fa89a.js" defer></script><script src="/assets/js/12.b1804325.js" defer></script>
  </body>
</html>
